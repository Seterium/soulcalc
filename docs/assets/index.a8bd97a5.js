var le=Object.defineProperty;var ae=(s,e,t)=>e in s?le(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var j=(s,e,t)=>(ae(s,typeof e!="symbol"?e+"":e,t),t);import{s as ie,d as ce,a as b,c as _,H as W,o as h,b as v,e as f,t as R,f as X,u as i,g as C,r as T,h as L,i as Y,j as re,n as P,k as U,V as ue,l as F,F as z,m as de,p as he,P as pe,q as J,v as Z,w as ee,x as te,y as N,z as S,A as H,B as se,C as _e,D as ve,E as fe,G as ge,I as me,J as ye}from"./vendor.d44bd2ed.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(l){if(l.ep)return;l.ep=!0;const o=t(l);fetch(l.href,o)}})();function be(s){let t="";for(let n=0;n<s.length;n+=5)t+=parseInt(s.substr(n,5),2).toString(32);return t}function xe(s){let e="";for(let t=0;t<s.length;t+=1){let n=parseInt(s.substr(t,1),32).toString(2);n.length<5&&(n="00000".slice(n.length)+n),e+=n}return e}function we(s){return`#${be(s)}`}function $e(s){return xe(s)}const V={encode:we,decode:$e};function Ce(){return Math.random().toString(16).slice(2)}function ke(){const s=document.createElement("canvas");if(!s.toDataURL)return!1;s.width=1,s.height=1;try{return s.toDataURL("image/webp").substring(5,15)==="image/webp"}catch{return!1}}function Se(s,e,t){return`${s.substring(0,e)}${t}${s.substring(e+1)}`}function Be(s){return Object.keys(s[0]).reduce((e,t)=>{const n=ie(s.map(l=>{var o;return(o=l==null?void 0:l[t])!=null?o:0}));return e[t]=`<span class="tip-summary">${n}</span>`,e},{})}const Ee="/soulcalc/data";async function Te(s){return fetch(`${Ee}/${s.lang}/talents.json?key=${Ce()}`).then(e=>e.json())}const I=0,Q=s=>(s+1>>>1)-1,O=s=>(s<<1)+1,M=s=>s+1<<1;class Ae{constructor(e){j(this,"heap",[]);j(this,"comparator");this.heap=[],this.comparator=e}reset(){this.heap=[]}get size(){return this.heap.length}get isEmpty(){return this.size===0}peek(){return this.heap[I]}push(...e){return e.forEach(t=>{this.heap.push(t),this.siftUp()}),this.size}pop(){const e=this.peek(),t=this.size-1;return t>I&&this.swap(I,t),this.heap.pop(),this.siftDown(),e}replace(e){const t=this.peek();return this.heap[I]=e,this.siftDown(),t}greater(e,t){return this.comparator(this.heap[e],this.heap[t])}swap(e,t){[this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]]}siftUp(){let e=this.size-1;for(;e>I&&this.greater(e,Q(e));)this.swap(e,Q(e)),e=Q(e)}siftDown(){let e=I;const t=()=>O(e)<this.size&&this.greater(O(e),e)||M(e)<this.size&&this.greater(M(e),e);for(;t();){const n=M(e)<this.size&&this.greater(M(e),O(e))?M(e):O(e);this.swap(e,n),e=n}}}const E=3.5,ne=1,$={scale:E,x:12,y:12,angle:90},G={x:32,y:64},w=ce("soulTalents",{state:()=>({loading:!0,error:!1,width:0,height:0,nodes:{},startNodeId:"0",talents:{},bonuses:[],map:{zoom:ne,initialPosition:{x:0,y:0},position:{x:0,y:0}},build:"",highlightIds:[],searchQuery:"",webpSupported:!1,lang:"ru",queue:null}),actions:{async load(){this.loading=!0,this.webpSupported=ke(),await this.loadSoulTalents(),this.createQueue(),this.loadBuild(),this.loading=!1},async loadSoulTalents(){try{const{width:s,height:e,nodes:t,talents:n,bonuses:l,startFrom:o}=await Te({lang:"ru"});this.width=s*E+64,this.height=e*E+64,this.talents=n,this.nodes=t,this.bonuses=Object.values(l),this.startNodeId=o,this.nodes[o].active=!0,this.map.initialPosition.x=this.nodes[o].x*E,this.map.initialPosition.y=this.nodes[o].y*E}catch{this.error=!0}},async loadBuild(){const s=V.decode(window.location.hash.slice(1));if(s.length===0){this.setClearBuild();return}for(let e=0;e<s.length-1;e+=1)this.nodes[`${e+1}`].active=s[e]==="1";this.setBuild(s)},createQueue(){this.queue=new Ae((s,e)=>s[1]>e[1])},activateNodes(s){s.forEach(e=>{this.nodes[e].active||(this.nodes[e].active=!0,this.updateBuildCell(e,!0))}),this.updateBuildUrlHash()},deactivateNodes(s,e=!0){s.forEach(t=>{if(t===this.startNodeId)return;const n=[t],l=this.nodes[t].connections.filter(o=>this.nodes[o].active);l.length>1&&l.forEach(o=>{n.push(...this.trackRoute(o,t))}),n.forEach(o=>{this.nodes[o].active=!1,this.updateBuildCell(o,!1)})}),e&&this.updateBuildUrlHash()},deactivateTalents(s){s.forEach(e=>{const t=this.activeNodes.reduce((n,l)=>(l.talentId===e&&n.push(l.id),n),[]);this.deactivateNodes(t,!1)}),this.updateBuildUrlHash()},resetNodes(){this.activeNodesIds.forEach(s=>{s!==this.startNodeId&&(this.nodes[s].active=!1)}),this.setClearBuild(),this.updateBuildUrlHash()},trackRoute(s,e){var n,l,o,c;(n=this.queue)==null||n.reset(),(l=this.queue)==null||l.push([s,"0"]);const t=[];for(t.push(e);!((o=this.queue)!=null&&o.isEmpty);){const d=(c=this.queue)==null?void 0:c.pop()[0];if(d===this.startNodeId)return[];t.push(d);const a=[];this.nodes[d].connections.forEach(u=>{!t.includes(u)&&this.nodes[u].active&&(t.push(u),a.push(u))}),a.forEach(u=>{var p;(p=this.queue)==null||p.push([u,a.length>1?"1":"0"])})}return t},updateBuildCell(s,e){this.build=Se(this.build,parseInt(s,10)-1,e?"1":"0")},setBuild(s){const e=Object.keys(this.nodes).length;if(s.length<e){const t=new Array(e-s.length).fill(0).join("");s=`${s}${t}`,this.build=s}this.build=s,this.updateBuildUrlHash()},setClearBuild(){this.build=[1,...new Array(Object.keys(this.nodes).length-1).fill(0)].join("")},updateBuildUrlHash(){window.history.replaceState(void 0,"",V.encode(this.build))}},getters:{activeNodes(s){return Object.values(s.nodes).filter(({active:e})=>e)},activeNodesIds(){return this.activeNodes.map(({id:s})=>s)},talentsGroups(s){return Object.keys(s.talents).map(e=>{const t=s.talents[e],n=Object.values(s.nodes).reduce((o,c)=>(c.talentId===e&&o.push(c),o),[]),l=n.filter(({active:o})=>o);return{talent:t,nodes:n,activeNodes:l}})}}}),De={class:"cell-details"},Ie={class:"cell-details__title"},Ne={class:"cell-details__rank"},He={key:0,class:"tip-green"},Me={class:"cell-details__description"},Le=["innerHTML"],ze={key:0,class:"cell-details__footer"},Pe=b({__name:"CellDetails",props:{cell:null,talent:null,rank:null,maxRank:null,forced:{type:Boolean},available:{type:Boolean}},setup(s){const e=s,t=_(()=>e.rank===0?"1":`${e.rank}`),n=_(()=>e.rank===e.maxRank?"-1":e.forced?`${e.maxRank}`:`${e.rank+1}`),l=_(()=>{var a;return(a=e.talent.ranks)==null?void 0:a[t.value]}),o=_(()=>{var a;return(a=e.talent.ranks)==null?void 0:a[n.value]}),c=_(()=>(e.forced||!e.cell.active)&&n.value!=="-1"),d=_(()=>{var r;const a=W.compile(e.talent.desc),p=Object.keys((r=l.value)!=null?r:{}).reduce((g,m)=>{var D,k;const x=(D=l.value)==null?void 0:D[m],y=(k=o.value)==null?void 0:k[m],A=x!==y&&c.value?`${x} => ${y}`:x;return g[m]=`<span class="tip-diff">${A}</span>`,g},{});return a(p)});return(a,u)=>(h(),v("div",De,[f("div",Ie,R(e.talent.name),1),f("div",Ne,[X(" \u0420\u0430\u043D\u0433: "+R(i(t))+" ",1),i(c)&&i(n)!=="1"?(h(),v("span",He," => "+R(i(n)),1)):C("v-if",!0)]),f("div",Me,[f("p",{innerHTML:i(d)},null,8,Le)]),e.available?C("v-if",!0):(h(),v("div",ze," \u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u0442\u044C - \u043D\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u0441\u0432\u044F\u0437\u0430\u043D\u043D\u044B\u0445 \u0443\u0437\u043B\u043E\u0432 "))]))}});const Oe=b({__name:"CellTooltip",props:{container:null,trigger:null,height:null,topSpace:null},setup(s){const e=s,t=T(),n=w(),l=L(t),o=L(e.trigger),c=L(e.container),d=Y(),a=_(()=>1/n.map.zoom),u=_(()=>{const y=m.value?"right":"left",B=r.value?"bottom":"top";return`${y} ${B}`}),p=_(()=>{const y=l.top.value-c.top.value,B=e.height-y,A=d.width.value-o.right.value;return{top:y,right:A,bottom:B}}),r=_(()=>p.value.bottom<=c.height.value+32),g=_(()=>!r.value),m=_(()=>p.value.right<=c.width.value+32),x=_(()=>!m.value);return(y,B)=>(h(),v("div",{ref_key:"$el",ref:t,class:P(["cell-tooltip",{"cell-tooltip--top":i(g),"cell-tooltip--left":i(m),"cell-tooltip--bottom":i(r),"cell-tooltip--right":i(x)}]),style:U({scale:i(a),transformOrigin:i(u)})},[re(y.$slots,"default")],6))}});const Re=b({__name:"CellConnectors",props:{cell:null},setup(s){const e=s,t=w(),n=e.cell.x*$.scale+$.x,l=e.cell.y*$.scale+$.y,o=e.cell.connections.map(c=>{const{x:d,y:a}=t.nodes[c],u=d*$.scale+$.x,p=a*$.scale+$.y,r=new ue(u-n,p-l);return{id:c,length:r.length(),angle:r.horizontalAngleDeg()+$.angle}});return(c,d)=>(h(!0),v(z,null,F(i(o),a=>(h(),v("div",{key:a.id,class:P(["cell-connector",{"cell-connector--active":i(t).nodes[a.id].active&&e.cell.active}]),style:U({height:`${a.length}px`,transform:`rotate(${a.angle}deg)`})},null,6))),128))}});function Fe(s,e){const t=w(),n=L(e);let l=null;return de(s,"panzoomchange",o=>{t.map.position.x=o.detail.x,t.map.position.y=o.detail.y}),he(()=>{if(s.value){const o=n.width.value/2-(t.map.initialPosition.x+G.x),c=n.height.value/2-(t.map.initialPosition.y+G.y);l=pe(s.value,{contain:"outside",startScale:ne,minScale:.1,maxScale:1,cursor:!1,startX:o,startY:c,step:window.screen.width>969?.4:.1,excludeClass:["cell"]}),t.map.position.x=o,t.map.position.y=c,e==null||e.addEventListener("wheel",d=>{if(l){const{x:a,y:u,scale:p}=l.zoomWithWheel(d);t.map.zoom=p,t.map.position.x=a,t.map.position.y=u}})}}),l}function Ue(s,e,t){return _(()=>`/soulcalc/data/${e}/icons/${s}.${t?"webp":"png"}`)}function je(s,e){const t=_(()=>`${e*E}px`),n=_(()=>`${s*E}px`);return{top:t,left:n}}const Qe=["onClick","onContextmenu"],qe=["src","alt"],Ve=b({__name:"Cell",props:{container:null,cell:null,talent:null,height:null,topSpace:null,isHoverActivateModeActive:{type:Boolean},isHoverDeactivateModeActive:{type:Boolean}},emits:["cell:activate","cell:deactivate"],setup(s,{emit:e}){const t=s,n=T(),l=T(),o=J(l),{shift:c,alt:d}=Z(),a=w(),u=_(()=>a.talentsGroups[+t.cell.talentId]),p=je(t.cell.x,t.cell.y),r=Ue(t.talent.icon,a.lang,a.webpSupported);ee(o,k=>{k?(a.highlightIds=[t.cell.talentId],t.isHoverActivateModeActive?A():t.isHoverDeactivateModeActive&&D()):a.highlightIds.includes(t.cell.talentId)&&(a.highlightIds=[])}),te(n,D,{modifiers:{prevent:!0}});const g=_(()=>t.cell.connections.some(k=>a.nodes[k].active||a.nodes[k].id==="1")),m=_(()=>o.value&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),x=_(()=>a.searchQuery.length>=3&&new RegExp(a.searchQuery,"i").test(t.talent.name)&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),y=_(()=>a.highlightIds.includes(t.cell.talentId)&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),B=_(()=>c.value||d.value);function A(){g.value&&e("cell:activate",t.cell.id)}function D(){t.cell.id!=="1"&&e("cell:deactivate",t.cell.id)}return(k,q)=>(h(),v("div",{ref_key:"$el",ref:n,class:"cell",style:U({top:i(p).top.value,left:i(p).left.value})},[f("div",{ref_key:"contentEl",ref:l,class:P(["cell__content",{"cell__content--start":t.cell.id==="1","cell__content--active":t.cell.active,"cell__content--uncommon":t.cell.quality===4,"cell__content--rare":t.cell.quality===5}]),onClick:N(A,["left","prevent"]),onContextmenu:[N(D,["right","prevent"]),q[0]||(q[0]=N(()=>{},["prevent"]))]},[f("img",{src:i(r),alt:s.talent.name},null,8,qe),f("div",{class:P(["cell__frame",{"cell__frame--search":i(x),"cell__frame--group":i(y)}])},null,2)],42,Qe),S(Re,{cell:t.cell},null,8,["cell"]),i(m)?(h(),H(Oe,{key:0,trigger:n.value,height:t.height,"top-space":t.topSpace,container:t.container},{default:se(()=>[S(Pe,{cell:t.cell,talent:t.talent,forced:i(B),rank:i(u).activeNodes.length,"max-rank":i(u).nodes.length,available:i(g)},null,8,["cell","talent","forced","rank","max-rank","available"])]),_:1},8,["trigger","height","top-space","container"])):C("v-if",!0)],4))}});const Ge=b({__name:"CalculatorMap",props:{container:null},setup(s){const e=s,t=T(),n=w();Fe(t,e.container);const l=Y(),o=L(t),{KeyE:c,KeyQ:d}=Z();function a(r){n.activateNodes([r])}function u(r){n.deactivateNodes([r])}function p(r){c.value&&!n.nodes[r].active?a(r):d.value&&u(r)}return(r,g)=>(h(),v("div",{ref_key:"$el",ref:t,class:"calculator-map",style:U({width:`${i(n).width}px`,height:`${i(n).height}px`})},[(h(!0),v(z,null,F(i(n).nodes,m=>(h(),H(Ve,{key:m.id,cell:m,talent:i(n).talents[m.talentId],height:i(l).height.value,"top-space":i(o).top.value,"is-hover-activate-mode-active":i(c),"is-hover-deactivate-mode-active":i(d),container:e.container,onHoverToogle:p,"onCell:activate":a,"onCell:deactivate":u},null,8,["cell","talent","height","top-space","is-hover-activate-mode-active","is-hover-deactivate-mode-active","container"]))),128))],4))}});const Ke={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},We=f("path",{d:"M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3l105.4 105.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256l105.3-105.4z"},null,-1);function Xe(s,e){return h(),v("svg",Ke,[C("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),We])}const Ye={render:Xe},Je={class:"calculator-search"},Ze=b({__name:"CalculatorSearch",setup(s){const e=w();function t(){e.searchQuery=""}return(n,l)=>(h(),v("div",Je,[_e(f("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>i(e).searchQuery=o),type:"text",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E",class:"calculator-search__field"},null,512),[[ve,i(e).searchQuery]]),i(e).searchQuery.length?(h(),v("button",{key:0,class:"calculator-search__clear",onClick:t},[S(i(Ye))])):C("v-if",!0)]))}});const et=["innerHTML"],K=b({__name:"CalculatorBonuse",props:{bonuse:null},setup(s){const e=s,t=T(),n=T(!1),l=J(t),o=w();ee(l,p=>{p?o.highlightIds=e.bonuse.talents:(n.value=!1,o.highlightIds=[])}),te(t,u,{delay:1500});function c(p){p.buttons&&(n.value=!0)}function d(){n.value=!0}function a(){n.value=!1}function u(){o.highlightIds=[],n.value=!1,o.deactivateTalents(e.bonuse.talents)}return(p,r)=>(h(),v("div",{ref_key:"$el",ref:t,class:P(["calculator-bonuse",{"calculator-bonuse--mousedown":n.value}]),onMousedown:c,onClick:r[0]||(r[0]=N(()=>{},["left","prevent"])),onContextmenu:[r[1]||(r[1]=N(()=>{},["right","prevent"])),r[2]||(r[2]=N(()=>{},["prevent"]))],onTouchstart:d,onTouchend:a,innerHTML:e.bonuse.text},null,42,et))}});const tt={class:"calculator-bonuses"},st=f("div",{class:"calculator-bonuses__title"}," \u042D\u0444\u0444\u0435\u043A\u0442\u044B ",-1),nt={key:1,class:"calculator-bonuses__placeholder"},ot=f("div",{class:"calculator-bonuses__title"}," \u0418\u0433\u0440\u0443\u0448\u043A\u0438 ",-1),lt=b({__name:"CalculatorBonuses",setup(s){const e=w(),t=_(()=>fe(e.activeNodes,"talentId")),n=e.bonuses.findIndex(({isToy:c})=>c),l=_(()=>{var d,a;return((a=(d=e.bonuses[n])==null?void 0:d.talents)!=null?a:[]).reduce((u,p)=>{var r;if(t.value[p]){const g=(r=e.talents[p])==null?void 0:r.name;g&&u.push({text:g,talents:[p]})}return u},[])}),o=_(()=>e.bonuses.reduce((c,d)=>{if(d.talents.every(g=>t.value[g]===void 0)||d.isToy)return c;const u=d.talents.map(g=>{var x,y;const m=t.value[g];return(y=(x=e.talents[g].ranks)==null?void 0:x[m])!=null?y:{}}),p=W.compile(d.desc),r=Be(u);return c.push({text:p(r),talents:d.talents}),c},[]));return(c,d)=>(h(),v("div",tt,[st,i(o).length?(h(!0),v(z,{key:0},F(i(o),(a,u)=>(h(),H(K,{key:u,bonuse:a},null,8,["bonuse"]))),128)):(h(),v("div",nt," \u041D\u0435\u0442 \u044D\u0444\u0444\u0435\u043A\u0442\u043E\u0432 \u043E\u0442 \u0432\u0437\u044F\u0442\u044B\u0445 \u0432\u0435\u0445 ")),i(l).length?(h(),v(z,{key:2},[ot,(h(!0),v(z,null,F(i(l),(a,u)=>(h(),H(K,{key:u,bonuse:a},null,8,["bonuse"]))),128))],64)):C("v-if",!0)]))}});const at={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},it=f("path",{d:"M0 96c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32 14.3 32 32z"},null,-1);function ct(s,e){return h(),v("svg",at,[C("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),it])}const rt={render:ct};const ut={class:"calculator-sidebar"},dt={class:"calculator-sidebar__header"},ht=f("div",{class:"calculator-sidebar__header-text"}," \u041A\u0430\u043B\u044C\u043A\u0443\u043B\u044F\u0442\u043E\u0440 \u0418\u0441\u043A\u0440\u044B ",-1),pt={class:"calculator-sidebar__footer"},_t={class:"calculator-sidebar__consumed"},vt=b({__name:"CalculatorSidebar",setup(s){const e=w();function t(){e.resetNodes()}return(n,l)=>(h(),v("div",ut,[f("div",dt,[ht,S(i(rt),{class:"calculator-sidebar__header-icon"})]),S(Ze),S(i(ge),{class:"calculator-sidebar__content"},{default:se(()=>[S(lt)]),_:1}),f("div",pt,[f("div",_t,[X(" \u041E\u0447\u043A\u043E\u0432 \u0432\u043B\u043E\u0436\u0435\u043D\u043E: "),f("b",null,R(i(e).activeNodesIds.length),1)]),f("button",{class:"calculator-sidebar__reset",onClick:t}," \u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C \u0432\u0441\u0435 ")])]))}});const ft={class:"calculator"},gt={class:"calculator__sidebar"},mt=f("div",{id:"tooltip-area",class:"calculator__tooltips"},null,-1),yt=b({__name:"Calculator",setup(s){const e=w();e.load();const t=T(),n=_(()=>!e.loading&&!e.error);return(l,o)=>(h(),v("div",ft,[f("div",{ref_key:"container",ref:t,class:"calculator__container"},[i(n)?(h(),H(Ge,{key:0,container:t.value},null,8,["container"])):C("v-if",!0)],512),f("div",gt,[i(n)?(h(),H(vt,{key:0})):C("v-if",!0)]),mt]))}});const bt={class:"app"},xt=b({__name:"App",setup(s){return(e,t)=>(h(),v("div",bt,[S(yt)]))}});const oe=me(xt),wt=ye();oe.use(wt);oe.mount("#aopro-spark-talents-calc");
