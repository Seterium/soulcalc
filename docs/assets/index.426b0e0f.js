var Z=Object.defineProperty;var J=(s,e,t)=>e in s?Z(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var U=(s,e,t)=>(J(s,typeof e!="symbol"?e+"":e,t),t);import{s as ee,d as te,c as m,a as $,r as x,u as W,w as Y,o as K,b as l,e as _,f as p,g as c,n as F,h as y,i as G,j as se,k as ne,l as oe,m as ie,F as D,p as q,q as L,t as H,v as ae,x as ue,y as C,z as re,H as ce,A as le,B as de,C as he,D as pe}from"./vendor.ddc24cd3.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function _e(s){let t="";for(let n=0;n<s.length;n+=5)t+=parseInt(s.substr(n,5),2).toString(32);return t}function fe(s){let e="";for(let t=0;t<s.length;t+=1){let n=parseInt(s.substr(t,1),32).toString(2);n.length<5&&(n="00000".slice(n.length)+n),e+=n}return e}function ve(s){return`#${_e(s)}`}function me(s){return fe(s)}const j={encode:ve,decode:me};function ge(){return Math.random().toString(16).slice(2)}function ye(){const s=document.createElement("canvas");if(!s.toDataURL)return!1;s.width=1,s.height=1;try{return s.toDataURL("image/webp").substring(5,15)==="image/webp"}catch{return!1}}function be(s,e,t){return`${s.substring(0,e)}${t}${s.substring(e+1)}`}function we(s){return Object.keys(s[0]).reduce((e,t)=>{const n=ee(s.map(o=>{var i;return(i=o==null?void 0:o[t])!=null?i:0}));return e[t]=`<span class="tip-summary">${n}</span>`,e},{})}const xe="/soulcalc/data";async function $e(s){return fetch(`${xe}/${s.lang}/talents.json?key=${ge()}`).then(e=>e.json())}const N=0,z=s=>(s+1>>>1)-1,P=s=>(s<<1)+1,I=s=>s+1<<1;class Se{constructor(e){U(this,"heap",[]);U(this,"comparator");this.heap=[],this.comparator=e}reset(){this.heap=[]}get size(){return this.heap.length}get isEmpty(){return this.size===0}peek(){return this.heap[N]}push(...e){return e.forEach(t=>{this.heap.push(t),this.siftUp()}),this.size}pop(){const e=this.peek(),t=this.size-1;return t>N&&this.swap(N,t),this.heap.pop(),this.siftDown(),e}replace(e){const t=this.peek();return this.heap[N]=e,this.siftDown(),t}greater(e,t){return this.comparator(this.heap[e],this.heap[t])}swap(e,t){[this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]]}siftUp(){let e=this.size-1;for(;e>N&&this.greater(e,z(e));)this.swap(e,z(e)),e=z(e)}siftDown(){let e=N;const t=()=>P(e)<this.size&&this.greater(P(e),e)||I(e)<this.size&&this.greater(I(e),e);for(;t();){const n=I(e)<this.size&&this.greater(I(e),P(e))?I(e):P(e);this.swap(e,n),e=n}}}const E=3.5,ke=1,B=te("soulTalents",{state:()=>({loading:!0,error:!1,width:0,height:0,startNodeId:0,nodes:[],edges:[],talents:[],bonuses:[],map:{zoom:ke,initialPosition:{x:0,y:0},position:{x:0,y:0}},build:"",highlightIds:[],searchQuery:"",webpSupported:!1,lang:"ru",queue:null,tooltip:{showed:!1,id:-1,clientRect:{x:0,y:0,height:0,width:0}}}),actions:{async load(){this.loading=!0,this.webpSupported=ye(),await this.loadSoulTalents(),this.createQueue(),this.loadBuild(),this.loading=!1},async loadSoulTalents(){try{const{width:s,height:e,nodes:t,talents:n,bonuses:o,startFrom:i,edges:a}=await $e({lang:"ru"});this.width=s*E+64,this.height=e*E+64,this.talents=n,this.edges=a,this.nodes=t,this.bonuses=Object.values(o),this.startNodeId=i,this.map.initialPosition.x=this.nodes[i].x*E,this.map.initialPosition.y=this.nodes[i].y*E}catch{this.error=!0}},async loadBuild(){const s=j.decode(window.location.hash.slice(1));if(s.length===0){this.setClearBuild();return}this.setBuild(s)},createQueue(){this.queue=new Se((s,e)=>s[1]>e[1])},activateNodes(s){s.forEach(e=>{this.build[e]==="1"||!this.nodes[e].connections.some(n=>this.build[n]==="1")||this.updateBuildCell(e,!0)}),this.updateBuildUrlHash()},deactivateNodes(s,e=!0){s.forEach(t=>{if(t===this.startNodeId)return;const n=[t],o=this.nodes[t].connections.filter(i=>this.build[i]==="1");o.length>1&&o.forEach(i=>{n.push(...this.trackRoute(i,t))}),n.forEach(i=>{this.updateBuildCell(i,!1)})}),e&&this.updateBuildUrlHash()},deactivateTalents(s){s.forEach(e=>{const t=this.activeNodes.reduce((n,o)=>(o.talentId===e&&n.push(o.id),n),[]);this.deactivateNodes(t,!1)}),this.updateBuildUrlHash()},resetNodes(){this.setClearBuild(),this.updateBuildUrlHash()},trackRoute(s,e){var n,o,i,a;(n=this.queue)==null||n.reset(),(o=this.queue)==null||o.push([s,0]);const t=[];for(t.push(e);!((i=this.queue)!=null&&i.isEmpty);){const u=(a=this.queue)==null?void 0:a.pop()[0];if(u===this.startNodeId)return[];t.push(u);const d=[];this.nodes[u].connections.forEach(r=>{!t.includes(r)&&this.build[r]==="1"&&(t.push(r),d.push(r))}),d.forEach(r=>{var v;(v=this.queue)==null||v.push([r,d.length>1?1:0])})}return t},updateBuildCell(s,e){this.build=be(this.build,s,e?"1":"0")},setBuild(s){if(s.length<this.nodes.length){const e=new Array(this.nodes.length-s.length).fill(0).join("");s=`${s}${e}`,this.build=s}this.build=s,this.updateBuildUrlHash()},setClearBuild(){this.build=[1,...new Array(this.nodes.length-1).fill(0)].join("")},updateBuildUrlHash(){window.history.replaceState(void 0,"",j.encode(this.build))},showTooltip(s,e){this.tooltip.showed=!0,this.tooltip.id=s,this.tooltip.clientRect=e},closeTooltip(){this.tooltip.showed=!1,this.tooltip.id=-1,this.tooltip.clientRect={x:0,y:0,height:0,width:0}}},getters:{activeNodes(s){return s.nodes.filter(e=>s.build[e.id]==="1")},activeNodesIds(){return this.activeNodes.map(s=>s.id)},talentsGroups(s){return s.talents.map(e=>{const t=s.nodes.filter(o=>o.talentId===e.id),n=t.filter(({id:o})=>s.build[o]==="1");return{talent:e,nodes:t,activeNodes:n}})}}});function Ce(s,e,t){return m(()=>`/soulcalc/data/${e}/icons/${s}.${t?"webp":"png"}`)}function Be(s,e){const t=m(()=>`${e*E}px`),n=m(()=>`${s*E}px`);return{top:t,left:n}}const Me=["onClick","onContextmenu"],Ne=["src","alt"],Ee=$({__name:"SCNode",props:{node:null},emits:["node:activate","node:deactivate"],setup(s,{emit:e}){const t=s,n=x(),o=x(),i=W(o),a=B(),u=Be(t.node.x,t.node.y);Y(i,k=>{k?a.highlightIds=[t.node.talentId]:a.highlightIds=[]}),K(n,()=>S(),{modifiers:{prevent:!0}});const d=m(()=>a.build[t.node.id]==="1"),r=m(()=>a.talents[t.node.talentId]),v=Ce(r.value.icon,a.lang,a.webpSupported),g=m(()=>t.node.connections.some(k=>a.build[k]==="1"||k===a.startNodeId)),f=m(()=>a.searchQuery.length>=3&&new RegExp(a.searchQuery,"i").test(r.value.name)),T=m(()=>a.highlightIds.includes(t.node.talentId));function M(){g.value&&e("node:activate",t.node.id)}function S(){t.node.id!==a.startNodeId&&e("node:deactivate",t.node.id)}return(k,A)=>(l(),_("div",{ref_key:"$el",ref:n,class:"sc-node",style:G({top:c(u).top.value,left:c(u).left.value})},[p("div",{ref_key:"contentEl",ref:o,class:F(["sc-node__content",{"sc-node__content--start":t.node.id===c(a).startNodeId,"sc-node__content--active":c(d),"sc-node__content--uncommon":t.node.quality===4,"sc-node__content--rare":t.node.quality===5}]),onClick:y(M,["left","prevent"]),onContextmenu:[y(S,["right","prevent"]),A[0]||(A[0]=y(()=>{},["prevent"]))]},[p("img",{src:c(v),alt:c(r).name},null,8,Ne),p("div",{class:F(["sc-node__frame",{"sc-node__frame--search":c(f),"sc-node__frame--group":c(T)}])},null,2)],42,Me)],4))}});const Te=["onMousedown","onMousemove","onMouseup","onMouseleave","onWheel"],Ie=$({__name:"SCMap",setup(s){const e=x(),t=B(),n=se(e),{pixelRatio:o}=ne(),i=x(!1),a=x(!1),u=x(1),d=oe({x:0,y:0}),r=m(()=>e.value?e.value.scrollWidth*u.value:0),v=m(()=>e.value?e.value.scrollHeight*u.value:0);ie(()=>{if(e.value){const h=t.map.initialPosition.x+10-n.width.value/2+24+12,b=t.map.initialPosition.y+10-n.height.value/2+24+12;e.value.scrollLeft=h,e.value.scrollTop=b}});function g(h){t.activateNodes([h])}function f(h){t.deactivateNodes([h])}function T(h){i.value=h.button===0,a.value=h.button===2,!(!i.value||h.shiftKey||h.altKey)&&(d.x=h.offsetX,d.y=h.offsetY)}function M(h){if(i.value&&e.value){let b=e.value.scrollLeft+-h.movementX*o.value,w=e.value.scrollTop+-h.movementY*o.value;const Q=Math.abs((e.value.scrollWidth-r.value)/2),R=Math.abs((e.value.scrollHeight-v.value)/2);b<Q&&(b=Q),b>r.value+24&&(b=r.value+24),w<R&&(w=R),w>v.value+24&&(w=v.value+24),e.value.scrollLeft=b,e.value.scrollTop=w}}function S(){i.value=!1,a.value=!1,d.x=0,d.y=0}function k(){i.value&&(i.value=!1,a.value=!1)}function A(h){h.deltaY>0&&u.value===.5||h.deltaY<0&&u.value===1||(u.value+=-h.deltaY/1e3)}return(h,b)=>(l(),_("div",{ref_key:"$el",ref:e,class:"sc-map",onMousedown:y(T,["stop"]),onMousemove:y(M,["stop"]),onMouseup:y(S,["stop"]),onMouseleave:y(k,["stop"]),onWheel:y(A,["prevent"])},[p("div",{class:"sc-map__wrap",style:G({height:`${c(t).height}px`,width:`${c(t).width}px`,transform:`scale(${u.value})`})},[(l(!0),_(D,null,q(c(t).nodes,w=>(l(),L(Ee,{key:w.id,node:w,"onNode:activate":g,"onNode:deactivate":f},null,8,["node"]))),128))],4)],40,Te))}});const Le={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Ae=p("path",{d:"M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3l105.4 105.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256l105.3-105.4z"},null,-1);function Pe(s,e){return l(),_("svg",Le,[H("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),Ae])}const De={render:Pe},He={class:"sc-search"},Ue=$({__name:"SCSearch",setup(s){const e=B();function t(){e.searchQuery=""}return(n,o)=>(l(),_("div",He,[ae(p("input",{"onUpdate:modelValue":o[0]||(o[0]=i=>c(e).searchQuery=i),type:"text",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E",class:"sc-search__field"},null,512),[[ue,c(e).searchQuery]]),c(e).searchQuery.length?(l(),_("button",{key:0,class:"sc-search__clear",onClick:t},[C(c(De))])):H("v-if",!0)]))}});const ze=["innerHTML"],O=$({__name:"SCBonuse",props:{bonuse:null},setup(s){const e=s,t=x(),n=x(!1),o=W(t),i=B();Y(o,g=>{g?i.highlightIds=e.bonuse.talents:(n.value=!1,i.highlightIds=[])}),K(t,v,{delay:1500});function a(g){g.buttons&&(n.value=!0)}function u(){n.value=!1}function d(){n.value=!0}function r(){n.value=!1}function v(){i.highlightIds=[],n.value=!1,i.deactivateTalents(e.bonuse.talents)}return(g,f)=>(l(),_("div",{ref_key:"$el",ref:t,class:F(["sc-bonuse",{"sc-bonuse--mousedown":n.value}]),onMousedown:a,onMouseup:u,onClick:f[0]||(f[0]=y(()=>{},["left","prevent"])),onContextmenu:[f[1]||(f[1]=y(()=>{},["right","prevent"])),f[2]||(f[2]=y(()=>{},["prevent"]))],onTouchstart:d,onTouchend:r,innerHTML:e.bonuse.text},null,42,ze))}});const Fe={class:"sc-bonuses"},qe=p("div",{class:"sc-bonuses__title"}," \u042D\u0444\u0444\u0435\u043A\u0442\u044B ",-1),Qe={key:1,class:"sc-bonuses__placeholder"},Re=p("div",{class:"sc-bonuses__title"}," \u0418\u0433\u0440\u0443\u0448\u043A\u0438 ",-1),je=$({__name:"SCBonuses",setup(s){const e=B(),t=m(()=>re(e.activeNodes,"talentId")),n=e.bonuses.findIndex(({isToy:a})=>a),o=m(()=>{var u,d;return((d=(u=e.bonuses[n])==null?void 0:u.talents)!=null?d:[]).reduce((r,v)=>{var g;if(t.value[v]){const f=(g=e.talents[v])==null?void 0:g.name;f&&r.push({text:f,talents:[v]})}return r},[])}),i=m(()=>e.bonuses.reduce((a,u)=>{if(u.talents.every(f=>t.value[f]===void 0)||u.isToy)return a;const r=u.talents.map(f=>{var M,S;const T=t.value[f]-1;return(S=(M=e.talents[f].ranks)==null?void 0:M[T])!=null?S:{}}),v=ce.compile(u.desc),g=we(r);return a.push({text:v(g),talents:u.talents}),a},[]));return(a,u)=>(l(),_("div",Fe,[qe,c(i).length?(l(!0),_(D,{key:0},q(c(i),(d,r)=>(l(),L(O,{key:r,bonuse:d},null,8,["bonuse"]))),128)):(l(),_("div",Qe," \u041D\u0435\u0442 \u044D\u0444\u0444\u0435\u043A\u0442\u043E\u0432 \u043E\u0442 \u0432\u0437\u044F\u0442\u044B\u0445 \u0432\u0435\u0445 ")),c(o).length?(l(),_(D,{key:2},[Re,(l(!0),_(D,null,q(c(o),(d,r)=>(l(),L(O,{key:r,bonuse:d},null,8,["bonuse"]))),128))],64)):H("v-if",!0)]))}});const Oe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},Ve=p("path",{d:"M0 96c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32 14.3 32 32z"},null,-1);function We(s,e){return l(),_("svg",Oe,[H("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),Ve])}const Ye={render:We},Ke={class:"sc-sidebar"},Ge={class:"sc-sidebar__header"},Xe=p("div",{class:"sc-sidebar__header-text"}," \u041A\u0430\u043B\u044C\u043A\u0443\u043B\u044F\u0442\u043E\u0440 \u0418\u0441\u043A\u0440\u044B ",-1),Ze={class:"sc-sidebar__content"},Je={class:"sc-sidebar__footer"},et={class:"sc-sidebar__consumed"},tt=$({__name:"SCSidebar",setup(s){const e=B();function t(){e.resetNodes()}return(n,o)=>(l(),_("div",Ke,[p("div",Ge,[Xe,C(c(Ye),{class:"sc-sidebar__header-icon"})]),C(Ue),p("div",Ze,[C(je)]),p("div",Je,[p("div",et,[le(" \u041E\u0447\u043A\u043E\u0432 \u0432\u043B\u043E\u0436\u0435\u043D\u043E: "),p("b",null,de(c(e).activeNodesIds.length),1)]),p("button",{class:"sc-sidebar__reset",onClick:t}," \u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C \u0432\u0441\u0435 ")])]))}});const st={viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},nt=p("path",{d:"M4 24c0 11.046 8.954 20 20 20v0c11.046 0 20-8.954 20-20S35.046 4 24 4",stroke:"#000","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),ot=p("path",{d:"M36 24c0-6.627-5.373-12-12-12s-12 5.373-12 12 5.373 12 12 12v0",stroke:"#000","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),it=[nt,ot];function at(s,e){return l(),_("svg",st,it)}const V={render:at},ut={class:"sc-main"},rt={ref:"container",class:"sc-main__container"},ct={key:1,class:"sc-main__loader"},lt={class:"sc-main__sidebar"},dt={key:1,class:"sc-main__loader"},ht=$({__name:"SCMain",setup(s){const e=B();e.load();const t=m(()=>!e.loading&&!e.error);return(n,o)=>(l(),_("div",ut,[p("div",rt,[c(t)?(l(),L(Ie,{key:0})):(l(),_("div",ct,[C(c(V))]))],512),p("div",lt,[c(t)?(l(),L(tt,{key:0})):(l(),_("div",dt,[C(c(V))]))])]))}});const pt={class:"app"},_t=$({__name:"App",setup(s){return(e,t)=>(l(),_("div",pt,[C(ht)]))}});const X=he(_t),ft=pe();X.use(ft);X.mount("#aopro-spark-talents-calc");
