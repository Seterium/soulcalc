import{s as ne,d as se,g as oe,a as $,u as Q,c as h,H as V,o as d,b as g,e as v,t as P,f as W,h as c,i as N,r as E,j as D,k as K,l as le,n as H,m as z,V as ae,p as O,F as M,q as ce,v as ie,P as re,w as q,x as X,y as Y,z as I,A as T,B as L,C as J,D as ue,E as de,G as he,I as _e,J as pe,K as ve}from"./vendor.0bb6238d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();function fe(n){let t="";for(let s=0;s<n.length;s+=5)t+=parseInt(n.substr(s,5),2).toString(32);return t}function ge(n){let e="";for(let t=0;t<n.length;t+=1){let s=parseInt(n.substr(t,1),32).toString(2);s.length<5&&(s="00000".slice(s.length)+s),e+=s}return e}function me(n){return`#${fe(n)}`}function ye(n){return ge(n)}const U={encode:me,decode:ye};function be(){return Math.random().toString(16).slice(2)}function Ce(){const n=document.createElement("canvas");if(!n.toDataURL)return!1;n.width=1,n.height=1;try{return n.toDataURL("image/webp").substring(5,15)==="image/webp"}catch{return!1}}function xe(n,e,t){return`${n.substring(0,e)}${t}${n.substring(e+1)}`}function $e(n){return Object.keys(n[0]).reduce((e,t)=>{const s=ne(n.map(o=>{var l;return(l=o==null?void 0:o[t])!=null?l:0}));return e[t]=`<span class="tip-summary">${s}</span>`,e},{})}const we="/soulcalc/data";async function ke(n){return fetch(`${we}/${n.lang}/talents.json?key=${be()}`).then(e=>e.json())}const A=3.5,Z=1,B={scale:A,x:12,y:12,angle:90},j={x:32,y:64},w=se("soulTalents",{state:()=>({loading:!0,error:!1,width:0,height:0,nodes:{},startNodeId:"0",talents:{},bonuses:[],map:{zoom:Z,initialPosition:{x:0,y:0},position:{x:0,y:0}},build:"",highlightIds:[],searchQuery:"",webpSupported:!1,lang:"ru",graph:null}),actions:{async load(){this.loading=!0,this.webpSupported=Ce(),await this.loadSoulTalents(),this.createGraph(),this.loadBuild(),this.loading=!1},async loadSoulTalents(){try{const{width:n,height:e,nodes:t,talents:s,bonuses:o,startFrom:l}=await ke({lang:"ru"});this.width=n*A+64,this.height=e*A+64,this.talents=s,this.nodes=t,this.bonuses=Object.values(o),this.startNodeId=l,this.nodes[l].active=!0,this.map.initialPosition.x=this.nodes[l].x*A,this.map.initialPosition.y=this.nodes[l].y*A}catch{this.error=!0}},async loadBuild(){const n=U.decode(window.location.hash.slice(1));if(n.length===0){this.setClearBuild();return}for(let e=0;e<n.length-1;e+=1)n[e]==="1"&&this.activateNodes([`${e+1}`]);this.setBuild(n)},createGraph(){this.graph=oe(),this.graph.addNode(this.startNodeId)},activateNodes(n,e=!1){n.forEach(t=>{var s;this.nodes[t].active||(this.nodes[t].active=!0,this.updateBuildCell(t,1),(s=this.graph)==null||s.addNode(t),this.nodes[t].connections.forEach(o=>{var l;(l=this.graph)==null||l.addEdge(t,o)}))}),e&&this.checkActiveNodesConnectionWithCenter(),this.updateBuildUrlHash()},deactivateNodes(n,e=!0,t=!0){n.forEach(s=>{var o;s!==this.startNodeId&&(this.nodes[s].active=!1,this.updateBuildCell(s,0),(o=this.graph)==null||o.removeNode(s))}),e&&this.checkActiveNodesConnectionWithCenter(),t&&this.updateBuildUrlHash()},deactivateTalents(n){n.forEach(e=>{const t=this.activeNodes.filter(s=>s.talentId===e).map(({id:s})=>s);this.deactivateNodes(t,!1,!1)}),this.checkActiveNodesConnectionWithCenter(),this.updateBuildUrlHash()},resetNodes(){this.activeNodesIds.forEach(n=>{var e;n!==this.startNodeId&&(this.nodes[n].active=!1,(e=this.graph)==null||e.removeNode(n))}),this.setClearBuild(),this.updateBuildUrlHash()},checkActiveNodesConnectionWithCenter(){this.activeNodesIds.forEach(n=>{var e;try{(e=this.graph)==null||e.shortestPath(n,"1")}catch{this.nodes[n].active=!1,this.updateBuildCell(n,0)}})},updateBuildCell(n,e){this.build=xe(this.build,parseInt(n,10)-1,e)},setBuild(n){const e=Object.keys(this.nodes).length;if(n.length<e){const t=new Array(e-n.length).fill(0).join("");n=`${n}${t}`,this.build=n}this.build=n,this.updateBuildUrlHash()},setClearBuild(){this.build=[1,...new Array(Object.keys(this.nodes).length-1).fill(0)].join("")},updateBuildUrlHash(){window.history.replaceState(void 0,"",U.encode(this.build))}},getters:{activeNodes(n){return Object.values(n.nodes).filter(({active:e})=>e)},activeNodesIds(){return this.activeNodes.map(({id:n})=>n)}}}),Se={class:"cell-details"},Be={class:"cell-details__title"},Te={class:"cell-details__rank"},Ne={key:0,class:"tip-green"},Ae={class:"cell-details__description"},Ee=["innerHTML"],Ie=$({__name:"CellDetails",props:{cell:null,talent:null,rank:null,maxRank:null},setup(n){const e=n,{shift:t,alt:s}=Q(),o=h(()=>t.value||s.value),l=h(()=>e.rank===0?"1":`${e.rank}`),a=h(()=>e.rank===e.maxRank?"-1":o.value?`${e.maxRank}`:`${e.rank+1}`),r=h(()=>{var i;return(i=e.talent.ranks)==null?void 0:i[l.value]}),u=h(()=>{var i;return(i=e.talent.ranks)==null?void 0:i[a.value]}),_=h(()=>(o.value||!e.cell.active)&&a.value!=="-1"),p=h(()=>{var k;const i=V.compile(e.talent.desc),f=Object.keys((k=r.value)!=null?k:{}).reduce((m,C)=>{var R,F;const S=(R=r.value)==null?void 0:R[C],y=(F=u.value)==null?void 0:F[C],te=S!==y&&_.value?`${S} => ${y}`:S;return m[C]=`<span class="tip-diff">${te}</span>`,m},{});return i(f)});return(i,b)=>(d(),g("div",Se,[v("div",Be,P(e.talent.name),1),v("div",Te,[W(" \u0420\u0430\u043D\u0433: "+P(c(l))+" ",1),c(_)&&c(a)!=="1"?(d(),g("span",Ne," => "+P(c(a)),1)):N("v-if",!0)]),v("div",Ae,[v("p",{innerHTML:c(p)},null,8,Ee)])]))}});const Le=$({__name:"CellTooltip",props:{container:null,trigger:null,height:null,topSpace:null},setup(n){const e=n,t=E(),s=w(),o=D(t),l=D(e.trigger),a=D(e.container),r=K(),u=h(()=>1/s.map.zoom),_=h(()=>{const m=f.value?"right":"left",C=i.value?"bottom":"top";return`${m} ${C}`}),p=h(()=>{const m=o.top.value-a.top.value,C=e.height-m,S=r.width.value-l.right.value;return{top:m,right:S,bottom:C}}),i=h(()=>p.value.bottom<=a.height.value+32),b=h(()=>!i.value),f=h(()=>p.value.right<=a.width.value+32),k=h(()=>!f.value);return(m,C)=>(d(),g("div",{ref_key:"$el",ref:t,class:H(["cell-tooltip",{"cell-tooltip--top":c(b),"cell-tooltip--left":c(f),"cell-tooltip--bottom":c(i),"cell-tooltip--right":c(k)}]),style:z({scale:c(u),transformOrigin:c(_)})},[le(m.$slots,"default")],6))}});const De=$({__name:"CellConnectors",props:{cell:null},setup(n){const e=n,t=w(),s=e.cell.x*B.scale+B.x,o=e.cell.y*B.scale+B.y,l=e.cell.connections.map(a=>{const{x:r,y:u}=t.nodes[a],_=r*B.scale+B.x,p=u*B.scale+B.y,i=new ae(_-s,p-o);return{id:a,length:i.length(),angle:i.horizontalAngleDeg()+B.angle}});return(a,r)=>(d(!0),g(M,null,O(c(l),u=>(d(),g("div",{key:u.id,class:H(["cell-connector",{"cell-connector--active":c(t).nodes[u.id].active&&e.cell.active}]),style:z({height:`${u.length}px`,transform:`rotate(${u.angle}deg)`})},null,6))),128))}});function Me(n,e){const t=w(),s=D(e);let o=null;return ce(n,"panzoomchange",l=>{t.map.position.x=l.detail.x,t.map.position.y=l.detail.y}),ie(()=>{if(n.value){const l=s.width.value/2-(t.map.initialPosition.x+j.x),a=s.height.value/2-(t.map.initialPosition.y+j.y);o=re(n.value,{contain:"outside",startScale:Z,minScale:.1,maxScale:1,cursor:!1,startX:l,startY:a,step:window.screen.width>969?.4:.1,excludeClass:["cell"]}),t.map.position.x=l,t.map.position.y=a,e==null||e.addEventListener("wheel",r=>{if(o){const{x:u,y:_,scale:p}=o.zoomWithWheel(r);t.map.zoom=p,t.map.position.x=u,t.map.position.y=_}})}}),o}function He(n,e,t){return h(()=>`/soulcalc/data/${e}/icons/${n}.${t?"webp":"png"}`)}function Pe(n,e){const t=h(()=>`${e*A}px`),s=h(()=>`${n*A}px`);return{top:t,left:s}}function Oe(n){const e=w(),t=h(()=>Object.values(e.nodes).filter(o=>o.talentId===n.talentId)),s=h(()=>t.value.filter(o=>e.activeNodesIds.includes(o.id)));return{list:t,active:s}}const ze=["onClick","onContextmenu"],Re=["src","alt"],Fe=$({__name:"Cell",props:{container:null,cell:null,talent:null,height:null,topSpace:null,isHoverActivateModeActive:{type:Boolean},isHoverDeactivateModeActive:{type:Boolean}},emits:["cell:activate","cell:deactivate","group:activate","group:deactivate"],setup(n,{emit:e}){const t=n,s=E(),o=E(),l=q(o),a=w(),r=Oe(t.cell),u=Pe(t.cell.x,t.cell.y),_=He(t.talent.icon,a.lang,a.webpSupported);X(l,y=>{y?(a.highlightIds=[t.cell.talentId],t.isHoverActivateModeActive?C():t.isHoverDeactivateModeActive&&S()):a.highlightIds.includes(t.cell.talentId)&&(a.highlightIds=[])}),Y(s,m,{modifiers:{prevent:!0}});const p=h(()=>t.cell.connections.some(y=>a.nodes[y].active||a.nodes[y].id==="1")),i=h(()=>l.value&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),b=h(()=>a.searchQuery.length>=3&&new RegExp(a.searchQuery,"i").test(t.talent.name)),f=h(()=>a.highlightIds.includes(t.cell.talentId));function k({shiftKey:y,altKey:x}){window.screen.width>969?C(y||x):t.cell.active?S():C()}function m({shiftKey:y,altKey:x}){S(y||x)}function C(y=!1){p.value&&(y?e("group:activate",r.list.value.map(({id:x})=>x)):e("cell:activate",t.cell.id))}function S(y=!1){t.cell.id!=="1"&&(y?e("group:deactivate",r.active.value.map(({id:x})=>x)):e("cell:deactivate",t.cell.id))}return(y,x)=>(d(),g("div",{ref_key:"$el",ref:s,class:"cell",style:z({top:c(u).top.value,left:c(u).left.value})},[v("div",{ref_key:"contentEl",ref:o,class:H(["cell__content",{"cell__content--start":t.cell.id==="1","cell__content--active":t.cell.active,"cell__content--uncommon":t.cell.quality===4,"cell__content--rare":t.cell.quality===5}]),onClick:I(k,["left","prevent"]),onContextmenu:[I(m,["right","prevent"]),x[0]||(x[0]=I(()=>{},["prevent"]))]},[v("img",{src:c(_),alt:n.talent.name},null,8,Re),v("div",{class:H(["cell__frame",{"cell__frame--search":c(b),"cell__frame--group":c(f)}])},null,2)],42,ze),T(De,{cell:t.cell},null,8,["cell"]),c(i)?(d(),L(Le,{key:0,trigger:s.value,height:t.height,"top-space":t.topSpace,container:t.container},{default:J(()=>[T(Ie,{cell:t.cell,talent:t.talent,rank:c(r).active.value.length,"max-rank":c(r).list.value.length},null,8,["cell","talent","rank","max-rank"])]),_:1},8,["trigger","height","top-space","container"])):N("v-if",!0)],4))}});const Ue=$({__name:"CalculatorMap",props:{container:null},setup(n){const e=n,t=E(),s=w();Me(t,e.container);const o=K(),l=D(t),{KeyE:a,KeyQ:r}=Q();function u(f){s.activateNodes([f])}function _(f){s.deactivateNodes([f])}function p(f){s.activateNodes(f,!0)}function i(f){s.deactivateNodes(f)}function b(f){a.value&&!s.nodes[f].active?u(f):r.value&&_(f)}return(f,k)=>(d(),g("div",{ref_key:"$el",ref:t,class:"calculator-map",style:z({width:`${c(s).width}px`,height:`${c(s).height}px`})},[(d(!0),g(M,null,O(c(s).nodes,m=>(d(),L(Fe,{key:m.id,cell:m,talent:c(s).talents[m.talentId],height:c(o).height.value,"top-space":c(l).top.value,"is-hover-activate-mode-active":c(a),"is-hover-deactivate-mode-active":c(r),container:e.container,onHoverToogle:b,"onCell:activate":u,"onCell:deactivate":_,"onGroup:activate":p,"onGroup:deactivate":i},null,8,["cell","talent","height","top-space","is-hover-activate-mode-active","is-hover-deactivate-mode-active","container"]))),128))],4))}});const je={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},Ge=v("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7l126.6 126.7c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208zM208 352c79.5 0 144-64.5 144-144S287.5 64 208 64 64 128.5 64 208s64.5 144 144 144z"},null,-1);function Qe(n,e){return d(),g("svg",je,[N("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),Ge])}const Ve={render:Qe},We={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Ke=v("path",{d:"M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3l105.4 105.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256l105.3-105.4z"},null,-1);function qe(n,e){return d(),g("svg",We,[N("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),Ke])}const Xe={render:qe},Ye={class:"calculator-search"},Je={class:"calculator-search__icon"},Ze=$({__name:"CalculatorSearch",setup(n){const e=w();function t(){e.searchQuery=""}return(s,o)=>(d(),g("div",Ye,[v("div",Je,[T(c(Ve))]),ue(v("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>c(e).searchQuery=l),type:"text",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E",class:"calculator-search__field"},null,512),[[de,c(e).searchQuery]]),c(e).searchQuery.length?(d(),g("button",{key:0,class:"calculator-search__clear",onClick:t},[T(c(Xe))])):N("v-if",!0)]))}});const et=["innerHTML"],G=$({__name:"CalculatorBonuse",props:{bonuse:null},setup(n){const e=n,t=E(),s=E(!1),o=q(t),l=w();X(o,p=>{p?l.highlightIds=e.bonuse.talents:(s.value=!1,l.highlightIds=[])}),Y(t,_,{delay:1500});function a(p){p.buttons&&(s.value=!0)}function r(){s.value=!0}function u(){s.value=!1}function _(){l.highlightIds=[],s.value=!1,l.deactivateTalents(e.bonuse.talents)}return(p,i)=>(d(),g("div",{ref_key:"$el",ref:t,class:H(["calculator-bonuse",{"calculator-bonuse--mousedown":s.value}]),onMousedown:a,onClick:i[0]||(i[0]=I(()=>{},["left","prevent"])),onContextmenu:[i[1]||(i[1]=I(()=>{},["right","prevent"])),i[2]||(i[2]=I(()=>{},["prevent"]))],onTouchstart:r,onTouchend:u,innerHTML:e.bonuse.text},null,42,et))}});const tt={class:"calculator-bonuses"},nt=v("div",{class:"calculator-bonuses__title"}," \u042D\u0444\u0444\u0435\u043A\u0442\u044B ",-1),st={key:1,class:"calculator-bonuses__placeholder"},ot=v("div",{class:"calculator-bonuses__title"}," \u0421\u043F\u0443\u0442\u043D\u0438\u043A\u0438 ",-1),lt=$({__name:"CalculatorBonuses",setup(n){const e=w(),t=h(()=>he(e.activeNodes,"talentId")),s=e.bonuses.findIndex(({isToy:a})=>a),o=h(()=>{var r,u;return((u=(r=e.bonuses[s])==null?void 0:r.talents)!=null?u:[]).reduce((_,p)=>{var i;if(t.value[p]){const b=(i=e.talents[p])==null?void 0:i.name;b&&_.push({text:b,talents:[p]})}return _},[])}),l=h(()=>e.bonuses.reduce((a,r)=>{if(r.talents.every(b=>t.value[b]===void 0)||r.isToy)return a;const _=r.talents.map(b=>{var k,m;const f=t.value[b];return(m=(k=e.talents[b].ranks)==null?void 0:k[f])!=null?m:{}}),p=V.compile(r.desc),i=$e(_);return a.push({text:p(i),talents:r.talents}),a},[]));return(a,r)=>(d(),g("div",tt,[nt,c(l).length?(d(!0),g(M,{key:0},O(c(l),(u,_)=>(d(),L(G,{key:_,bonuse:u},null,8,["bonuse"]))),128)):(d(),g("div",st," \u041D\u0435\u0442 \u044D\u0444\u0444\u0435\u043A\u0442\u043E\u0432 \u043E\u0442 \u0432\u0437\u044F\u0442\u044B\u0445 \u0432\u0435\u0445 ")),c(o).length?(d(),g(M,{key:2},[ot,(d(!0),g(M,null,O(c(o),(u,_)=>(d(),L(G,{key:_,bonuse:u},null,8,["bonuse"]))),128))],64)):N("v-if",!0)]))}});const at={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},ct=v("path",{d:"M0 96c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32 14.3 32 32z"},null,-1);function it(n,e){return d(),g("svg",at,[N("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),ct])}const rt={render:it};const ut={class:"calculator-sidebar"},dt={class:"calculator-sidebar__header"},ht=v("div",{class:"calculator-sidebar__header-text"}," \u041A\u0430\u043B\u044C\u043A\u0443\u043B\u044F\u0442\u043E\u0440 \u0418\u0441\u043A\u0440\u044B ",-1),_t={class:"calculator-sidebar__footer"},pt={class:"calculator-sidebar__consumed"},vt=$({__name:"CalculatorSidebar",setup(n){const e=w();function t(){e.resetNodes()}return(s,o)=>(d(),g("div",ut,[v("div",dt,[ht,T(c(rt),{class:"calculator-sidebar__header-icon"})]),T(Ze),T(c(_e),{class:"calculator-sidebar__content"},{default:J(()=>[T(lt)]),_:1}),v("div",_t,[v("div",pt,[W(" \u041E\u0447\u043A\u043E\u0432 \u0432\u043B\u043E\u0436\u0435\u043D\u043E: "),v("b",null,P(c(e).activeNodesIds.length),1)]),v("button",{class:"calculator-sidebar__reset",onClick:t}," \u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C \u0432\u0441\u0435 ")])]))}});const ft={class:"calculator"},gt={class:"calculator__sidebar"},mt=v("div",{id:"tooltip-area",class:"calculator__tooltips"},null,-1),yt=$({__name:"Calculator",setup(n){const e=w();e.load();const t=E(),s=h(()=>!e.loading&&!e.error);return(o,l)=>(d(),g("div",ft,[v("div",{ref_key:"container",ref:t,class:"calculator__container"},[c(s)?(d(),L(Ue,{key:0,container:t.value},null,8,["container"])):N("v-if",!0)],512),v("div",gt,[c(s)?(d(),L(vt,{key:0})):N("v-if",!0)]),mt]))}});const bt={class:"app"},Ct=$({__name:"App",setup(n){return(e,t)=>(d(),g("div",bt,[T(yt)]))}});const ee=pe(Ct),xt=ve();ee.use(xt);ee.mount("#aopro-spark-talents-calc");
