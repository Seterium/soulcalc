var ce=Object.defineProperty;var ie=(s,e,t)=>e in s?ce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var F=(s,e,t)=>(ie(s,typeof e!="symbol"?e+"":e,t),t);import{s as re,d as ue,a as w,c as f,H as Y,o as u,b as p,e as v,t as P,f as J,u as c,g as N,V as de,r as z,n as R,h as j,F as H,i as Z,j as ee,k as he,P as _e,l as E,m as te,p as se,w as ne,q as oe,v as y,x as Q,E as pe,y as I,z as ve,A as M,B as fe,C as me,D as ge,G as ye,I as we,J as be}from"./vendor.c5412f26.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();function xe(s){let t="";for(let n=0;n<s.length;n+=5)t+=parseInt(s.substr(n,5),2).toString(32);return t}function ke(s){let e="";for(let t=0;t<s.length;t+=1){let n=parseInt(s.substr(t,1),32).toString(2);n.length<5&&(n="00000".slice(n.length)+n),e+=n}return e}function $e(s){return`#${xe(s)}`}function Ce(s){return ke(s)}const G={encode:$e,decode:Ce};function Ee(){return Math.random().toString(16).slice(2)}function Se(){const s=document.createElement("canvas");if(!s.toDataURL)return!1;s.width=1,s.height=1;try{return s.toDataURL("image/webp").substring(5,15)==="image/webp"}catch{return!1}}function Be(s,e,t){return`${s.substring(0,e)}${t}${s.substring(e+1)}`}function Ae(s){return Object.keys(s[0]).reduce((e,t)=>{const n=re(s.map(o=>{var a;return(a=o==null?void 0:o[t])!=null?a:0}));return e[t]=`<span class="tip-summary">${n}</span>`,e},{})}const Ie="/soulcalc/data";async function Ne(s){return fetch(`${Ie}/${s.lang}/talents.json?key=${Ee()}`).then(e=>e.json())}const A=0,U=s=>(s+1>>>1)-1,L=s=>(s<<1)+1,D=s=>s+1<<1;class Te{constructor(e){F(this,"heap",[]);F(this,"comparator");this.heap=[],this.comparator=e}reset(){this.heap=[]}get size(){return this.heap.length}get isEmpty(){return this.size===0}peek(){return this.heap[A]}push(...e){return e.forEach(t=>{this.heap.push(t),this.siftUp()}),this.size}pop(){const e=this.peek(),t=this.size-1;return t>A&&this.swap(A,t),this.heap.pop(),this.siftDown(),e}replace(e){const t=this.peek();return this.heap[A]=e,this.siftDown(),t}greater(e,t){return this.comparator(this.heap[e],this.heap[t])}swap(e,t){[this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]]}siftUp(){let e=this.size-1;for(;e>A&&this.greater(e,U(e));)this.swap(e,U(e)),e=U(e)}siftDown(){let e=A;const t=()=>L(e)<this.size&&this.greater(L(e),e)||D(e)<this.size&&this.greater(D(e),e);for(;t();){const n=D(e)<this.size&&this.greater(D(e),L(e))?D(e):L(e);this.swap(e,n),e=n}}}const C=3.5,ae=1,b={scale:C,x:12,y:12,angle:90},K={x:32,y:64},x=ue("soulTalents",{state:()=>({loading:!0,error:!1,width:0,height:0,startNodeId:0,nodes:[],talents:[],bonuses:[],map:{zoom:ae,initialPosition:{x:0,y:0},position:{x:0,y:0}},build:"",highlightIds:[],searchQuery:"",webpSupported:!1,lang:"ru",queue:null}),actions:{async load(){this.loading=!0,this.webpSupported=Se(),await this.loadSoulTalents(),this.createQueue(),this.loadBuild(),this.loading=!1},async loadSoulTalents(){try{const{width:s,height:e,nodes:t,talents:n,bonuses:o,startFrom:a}=await Ne({lang:"ru"});this.width=s*C+64,this.height=e*C+64,this.talents=n,this.nodes=t,this.bonuses=Object.values(o),this.startNodeId=a,this.nodes[a].active=!0,this.map.initialPosition.x=this.nodes[a].x*C,this.map.initialPosition.y=this.nodes[a].y*C}catch{this.error=!0}},async loadBuild(){const s=G.decode(window.location.hash.slice(1));if(s.length===0){this.setClearBuild();return}for(let e=0;e<s.length-1;e+=1)this.nodes[e].active=s[e]==="1";this.setBuild(s)},createQueue(){this.queue=new Te((s,e)=>s[1]>e[1])},activateNodes(s){s.forEach(e=>{this.nodes[e].active||(this.nodes[e].active=!0,this.updateBuildCell(e,!0))}),this.updateBuildUrlHash()},deactivateNodes(s,e=!0){s.forEach(t=>{if(t===this.startNodeId)return;const n=[t],o=this.nodes[t].connections.filter(a=>this.nodes[a].active);o.length>1&&o.forEach(a=>{n.push(...this.trackRoute(a,t))}),n.forEach(a=>{this.nodes[a].active=!1,this.updateBuildCell(a,!1)})}),e&&this.updateBuildUrlHash()},deactivateTalents(s){s.forEach(e=>{const t=this.activeNodes.reduce((n,o)=>(o.talentId===e&&n.push(o.id),n),[]);this.deactivateNodes(t,!1)}),this.updateBuildUrlHash()},resetNodes(){this.activeNodesIds.forEach(s=>{s!==this.startNodeId&&(this.nodes[s].active=!1)}),this.setClearBuild(),this.updateBuildUrlHash()},trackRoute(s,e){var n,o,a,i;(n=this.queue)==null||n.reset(),(o=this.queue)==null||o.push([s,0]);const t=[];for(t.push(e);!((a=this.queue)!=null&&a.isEmpty);){const h=(i=this.queue)==null?void 0:i.pop()[0];if(h===this.startNodeId)return[];t.push(h);const l=[];this.nodes[h].connections.forEach(r=>{!t.includes(r)&&this.nodes[r].active&&(t.push(r),l.push(r))}),l.forEach(r=>{var _;(_=this.queue)==null||_.push([r,l.length>1?1:0])})}return t},updateBuildCell(s,e){this.build=Be(this.build,s,e?"1":"0")},setBuild(s){if(s.length<this.nodes.length){const e=new Array(this.nodes.length-s.length).fill(0).join("");s=`${s}${e}`,this.build=s}this.build=s,this.updateBuildUrlHash()},setClearBuild(){this.build=[1,...new Array(this.nodes.length-1).fill(0)].join("")},updateBuildUrlHash(){window.history.replaceState(void 0,"",G.encode(this.build))}},getters:{activeNodes(s){return Object.values(s.nodes).filter(({active:e})=>e)},activeNodesIds(){return this.activeNodes.map(({id:s})=>s)},talentsGroups(s){return s.talents.map(e=>{const t=s.nodes.filter(o=>o.talentId===e.id),n=t.filter(({active:o})=>o);return{talent:e,nodes:t,activeNodes:n}})}}}),De={class:"cell-details"},He={class:"cell-details__title"},Me={class:"cell-details__rank"},Le={key:0,class:"tip-green"},Pe={class:"cell-details__description"},ze=["innerHTML"],Re={key:0,class:"cell-details__footer"},Oe=w({__name:"CellDetails",props:{cell:null,talent:null,rank:null,maxRank:null,forced:{type:Boolean},available:{type:Boolean},startNode:{type:Boolean}},setup(s){const e=s,t=f(()=>e.rank===0?1:e.rank),n=f(()=>e.rank===e.maxRank?-1:e.forced?e.maxRank:e.rank+1),o=f(()=>{var l;return(l=e.talent.ranks)==null?void 0:l[t.value-1]}),a=f(()=>{var l;return(l=e.talent.ranks)==null?void 0:l[n.value-1]}),i=f(()=>(e.forced||!e.cell.active)&&n.value!==-1),h=f(()=>{var d;const l=Y.compile(e.talent.desc),_=Object.keys((d=o.value)!=null?d:{}).reduce((m,g)=>{var T,S;const k=(T=o.value)==null?void 0:T[g],$=(S=a.value)==null?void 0:S[g],O=k!==$&&i.value?`${k} => ${$}`:k;return m[g]=`<span class="tip-diff">${O}</span>`,m},{});return l(_)});return(l,r)=>(u(),p("div",De,[v("div",He,P(e.talent.name),1),v("div",Me,[J(" \u0420\u0430\u043D\u0433: "+P(c(t))+" ",1),c(i)&&c(n)!==1?(u(),p("span",Le," => "+P(c(n)),1)):N("v-if",!0)]),v("div",Pe,[v("p",{innerHTML:c(h)},null,8,ze)]),e.available||e.startNode?N("v-if",!0):(u(),p("div",Re," \u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0430\u043A\u0442\u0438\u0432\u0438\u0440\u043E\u0432\u0430\u0442\u044C - \u043D\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u0443\u0437\u043B\u043E\u0432 \u0440\u044F\u0434\u043E\u043C "))]))}});const Fe=w({__name:"CellConnectors",props:{cell:null},setup(s){const e=s,t=x(),n=e.cell.x*b.scale+b.x,o=e.cell.y*b.scale+b.y,a=e.cell.connections.map(i=>{const{x:h,y:l}=t.nodes[i],r=h*b.scale+b.x,_=l*b.scale+b.y,d=new de(r-n,_-o);return{id:i,length:d.length(),angle:d.horizontalAngleDeg()+b.angle}});return(i,h)=>(u(!0),p(H,null,z(c(a),l=>(u(),p("div",{key:l.id,class:R(["cell-connector",{"cell-connector--active":c(t).nodes[l.id].active&&e.cell.active}]),style:j({height:`${l.length}px`,transform:`rotate(${l.angle}deg)`})},null,6))),128))}});function Ue(s,e){const t=x(),n=Z(e);let o=null;return ee(s,"panzoomchange",a=>{t.map.position.x=a.detail.x,t.map.position.y=a.detail.y}),he(()=>{if(s.value){const a=n.width.value/2-(t.map.initialPosition.x+K.x),i=n.height.value/2-(t.map.initialPosition.y+K.y);o=_e(s.value,{contain:"outside",startScale:ae,minScale:.1,maxScale:1,cursor:!1,startX:a,startY:i,step:window.screen.width>969?.4:.1,excludeClass:["cell"]}),t.map.position.x=a,t.map.position.y=i,e==null||e.addEventListener("wheel",h=>{if(o){const{x:l,y:r,scale:_}=o.zoomWithWheel(h);t.map.zoom=_,t.map.position.x=l,t.map.position.y=r}})}}),o}function Qe(s,e,t){return f(()=>`/soulcalc/data/${e}/icons/${s}.${t?"webp":"png"}`)}function je(s,e){const t=f(()=>`${e*C}px`),n=f(()=>`${s*C}px`);return{top:t,left:n}}const qe=["onClick","onContextmenu"],Ve=["src","alt"],Ge=w({__name:"Cell",props:{container:null,cell:null,talent:null,height:null,topSpace:null,isHoverActivateModeActive:{type:Boolean},isHoverDeactivateModeActive:{type:Boolean}},emits:["cell:activate","cell:deactivate"],setup(s,{emit:e}){const t=s,n=E(),o=E(),a=te(o),{shift:i,alt:h}=se(),l=x(),r=f(()=>l.talentsGroups[+t.cell.talentId]),_=je(t.cell.x,t.cell.y),d=Qe(t.talent.icon,l.lang,l.webpSupported),m=E(!1);ne(a,B=>{m.value=B,B?(l.highlightIds=[t.cell.talentId],t.isHoverActivateModeActive?T():t.isHoverDeactivateModeActive&&S()):l.highlightIds.includes(t.cell.talentId)&&(l.highlightIds=[])}),oe(n,S,{modifiers:{prevent:!0}}),ee("wheel",()=>{m.value=!1},{passive:!0});const g=f(()=>t.cell.connections.some(B=>l.nodes[B].active||l.nodes[B].id===l.startNodeId)),k=f(()=>m.value&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),$=f(()=>l.searchQuery.length>=3&&new RegExp(l.searchQuery,"i").test(t.talent.name)&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),q=f(()=>l.highlightIds.includes(t.cell.talentId)&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),O=f(()=>i.value||h.value);function T(){g.value&&e("cell:activate",t.cell.id)}function S(){t.cell.id!==l.startNodeId&&e("cell:deactivate",t.cell.id)}return(B,V)=>(u(),p("div",{ref_key:"$el",ref:n,class:"cell",style:j({top:c(_).top.value,left:c(_).left.value})},[y(c(pe),{placement:"right-start",width:240,"hide-after":0,visible:c(k),"show-arrow":!1},{reference:Q(()=>[v("div",{ref_key:"contentEl",ref:o,class:R(["cell__content",{"cell__content--start":t.cell.id===c(l).startNodeId,"cell__content--active":t.cell.active,"cell__content--uncommon":t.cell.quality===4,"cell__content--rare":t.cell.quality===5}]),onClick:I(T,["left","prevent"]),onContextmenu:[I(S,["right","prevent"]),V[0]||(V[0]=I(()=>{},["prevent"]))]},[v("img",{src:c(d),alt:s.talent.name},null,8,Ve),v("div",{class:R(["cell__frame",{"cell__frame--search":c($),"cell__frame--group":c(q)}])},null,2)],42,qe)]),default:Q(()=>[y(Oe,{cell:t.cell,talent:t.talent,forced:c(O),rank:c(r).activeNodes.length,"max-rank":c(r).nodes.length,available:c(g),"start-node":t.cell.id===c(l).startNodeId},null,8,["cell","talent","forced","rank","max-rank","available","start-node"])]),_:1},8,["visible"]),y(Fe,{cell:t.cell},null,8,["cell"])],4))}});const Ke=w({__name:"CalculatorMap",props:{container:null},setup(s){const e=s,t=E(),n=x();Ue(t,e.container);const o=ve(),a=Z(t),{KeyE:i,KeyQ:h}=se();function l(d){n.activateNodes([d])}function r(d){n.deactivateNodes([d])}function _(d){i.value&&!n.nodes[d].active?l(d):h.value&&r(d)}return(d,m)=>(u(),p("div",{ref_key:"$el",ref:t,class:"calculator-map",style:j({width:`${c(n).width}px`,height:`${c(n).height}px`})},[(u(!0),p(H,null,z(c(n).nodes,g=>(u(),M(Ge,{key:g.id,cell:g,talent:c(n).talents[g.talentId],height:c(o).height.value,"top-space":c(a).top.value,"is-hover-activate-mode-active":c(i),"is-hover-deactivate-mode-active":c(h),container:e.container,onHoverToogle:_,"onCell:activate":l,"onCell:deactivate":r},null,8,["cell","talent","height","top-space","is-hover-activate-mode-active","is-hover-deactivate-mode-active","container"]))),128))],4))}});const We={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Xe=v("path",{d:"M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3l105.4 105.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256l105.3-105.4z"},null,-1);function Ye(s,e){return u(),p("svg",We,[N("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),Xe])}const Je={render:Ye},Ze={class:"calculator-search"},et=w({__name:"CalculatorSearch",setup(s){const e=x();function t(){e.searchQuery=""}return(n,o)=>(u(),p("div",Ze,[fe(v("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>c(e).searchQuery=a),type:"text",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E",class:"calculator-search__field"},null,512),[[me,c(e).searchQuery]]),c(e).searchQuery.length?(u(),p("button",{key:0,class:"calculator-search__clear",onClick:t},[y(c(Je))])):N("v-if",!0)]))}});const tt=["innerHTML"],W=w({__name:"CalculatorBonuse",props:{bonuse:null},setup(s){const e=s,t=E(),n=E(!1),o=te(t),a=x();ne(o,_=>{_?a.highlightIds=e.bonuse.talents:(n.value=!1,a.highlightIds=[])}),oe(t,r,{delay:1500});function i(_){_.buttons&&(n.value=!0)}function h(){n.value=!0}function l(){n.value=!1}function r(){a.highlightIds=[],n.value=!1,a.deactivateTalents(e.bonuse.talents)}return(_,d)=>(u(),p("div",{ref_key:"$el",ref:t,class:R(["calculator-bonuse",{"calculator-bonuse--mousedown":n.value}]),onMousedown:i,onClick:d[0]||(d[0]=I(()=>{},["left","prevent"])),onContextmenu:[d[1]||(d[1]=I(()=>{},["right","prevent"])),d[2]||(d[2]=I(()=>{},["prevent"]))],onTouchstart:h,onTouchend:l,innerHTML:e.bonuse.text},null,42,tt))}});const st={class:"calculator-bonuses"},nt=v("div",{class:"calculator-bonuses__title"}," \u042D\u0444\u0444\u0435\u043A\u0442\u044B ",-1),ot={key:1,class:"calculator-bonuses__placeholder"},at=v("div",{class:"calculator-bonuses__title"}," \u0418\u0433\u0440\u0443\u0448\u043A\u0438 ",-1),lt=w({__name:"CalculatorBonuses",setup(s){const e=x(),t=f(()=>ge(e.activeNodes,"talentId")),n=e.bonuses.findIndex(({isToy:i})=>i),o=f(()=>{var h,l;return((l=(h=e.bonuses[n])==null?void 0:h.talents)!=null?l:[]).reduce((r,_)=>{var d;if(t.value[_]){const m=(d=e.talents[_])==null?void 0:d.name;m&&r.push({text:m,talents:[_]})}return r},[])}),a=f(()=>e.bonuses.reduce((i,h)=>{if(h.talents.every(m=>t.value[m]===void 0)||h.isToy)return i;const r=h.talents.map(m=>{var k,$;const g=t.value[m]-1;return($=(k=e.talents[m].ranks)==null?void 0:k[g])!=null?$:{}}),_=Y.compile(h.desc),d=Ae(r);return i.push({text:_(d),talents:h.talents}),i},[]));return(i,h)=>(u(),p("div",st,[nt,c(a).length?(u(!0),p(H,{key:0},z(c(a),(l,r)=>(u(),M(W,{key:r,bonuse:l},null,8,["bonuse"]))),128)):(u(),p("div",ot," \u041D\u0435\u0442 \u044D\u0444\u0444\u0435\u043A\u0442\u043E\u0432 \u043E\u0442 \u0432\u0437\u044F\u0442\u044B\u0445 \u0432\u0435\u0445 ")),c(o).length?(u(),p(H,{key:2},[at,(u(!0),p(H,null,z(c(o),(l,r)=>(u(),M(W,{key:r,bonuse:l},null,8,["bonuse"]))),128))],64)):N("v-if",!0)]))}});const ct={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},it=v("path",{d:"M0 96c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32 14.3 32 32z"},null,-1);function rt(s,e){return u(),p("svg",ct,[N("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),it])}const ut={render:rt};const dt={class:"calculator-sidebar"},ht={class:"calculator-sidebar__header"},_t=v("div",{class:"calculator-sidebar__header-text"}," \u041A\u0430\u043B\u044C\u043A\u0443\u043B\u044F\u0442\u043E\u0440 \u0418\u0441\u043A\u0440\u044B ",-1),pt={class:"calculator-sidebar__footer"},vt={class:"calculator-sidebar__consumed"},ft=w({__name:"CalculatorSidebar",setup(s){const e=x();function t(){e.resetNodes()}return(n,o)=>(u(),p("div",dt,[v("div",ht,[_t,y(c(ut),{class:"calculator-sidebar__header-icon"})]),y(et),y(c(ye),{class:"calculator-sidebar__content"},{default:Q(()=>[y(lt)]),_:1}),v("div",pt,[v("div",vt,[J(" \u041E\u0447\u043A\u043E\u0432 \u0432\u043B\u043E\u0436\u0435\u043D\u043E: "),v("b",null,P(c(e).activeNodesIds.length),1)]),v("button",{class:"calculator-sidebar__reset",onClick:t}," \u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C \u0432\u0441\u0435 ")])]))}});const mt={viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},gt=v("path",{d:"M4 24c0 11.046 8.954 20 20 20v0c11.046 0 20-8.954 20-20S35.046 4 24 4",stroke:"#000","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),yt=v("path",{d:"M36 24c0-6.627-5.373-12-12-12s-12 5.373-12 12 5.373 12 12 12v0",stroke:"#000","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),wt=[gt,yt];function bt(s,e){return u(),p("svg",mt,wt)}const X={render:bt},xt={class:"calculator"},kt={key:1,class:"calculator__loader"},$t={class:"calculator__sidebar"},Ct={key:1,class:"calculator__loader"},Et=w({__name:"Calculator",setup(s){const e=x();e.load();const t=E(),n=f(()=>!e.loading&&!e.error);return(o,a)=>(u(),p("div",xt,[v("div",{ref_key:"container",ref:t,class:"calculator__container"},[c(n)?(u(),M(Ke,{key:0,container:t.value},null,8,["container"])):(u(),p("div",kt,[y(c(X))]))],512),v("div",$t,[c(n)?(u(),M(ft,{key:0})):(u(),p("div",Ct,[y(c(X))]))])]))}});const St={class:"app"},Bt=w({__name:"App",setup(s){return(e,t)=>(u(),p("div",St,[y(Et)]))}});const le=we(Bt),At=be();le.use(At);le.mount("#aopro-spark-talents-calc");
