import{d as X,g as Q,a as b,u as G,c as i,H as V,o as p,b as k,e as f,t as T,f as c,r as E,h as I,i as Z,j as W,k as J,n as H,l as D,V as ee,m as L,F as P,p as te,q as ne,P as oe,s as se,w as le,v as O,x as M,y as A,z as R,A as ae,B as ce,C as ie,D as re,E as ue}from"./vendor.4c20afcf.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();function de(n){let t="";for(let s=0;s<n.length;s+=5)t+=parseInt(n.substr(s,5),2).toString(32);return t}function he(n){let e="";for(let t=0;t<n.length;t+=1){let s=parseInt(n.substr(t,1),32).toString(2);s.length<5&&(s="00000".slice(s.length)+s),e+=s}return e}function pe(n){return`#${de(n)}`}function ve(n){return he(n)}const U={encode:pe,decode:ve};function _e(){return Math.random().toString(16).slice(2)}function fe(){const n=document.createElement("canvas");if(!n.toDataURL)return!1;n.width=1,n.height=1;try{return n.toDataURL("image/webp").substring(5,15)==="image/webp"}catch{return!1}}function ge(n,e,t){return`${n.substring(0,e)}${t}${n.substring(e+1)}`}const me="/soulcalc/data";async function ye(n){return fetch(`${me}/${n.lang}/talents.json?key=${_e()}`).then(e=>e.json())}const N=3.5,K=1,$={scale:N,x:12,y:12,angle:90},F={x:32,y:64},w=X("soulTalents",{state:()=>({loading:!0,error:!1,width:0,height:0,nodes:{},startNodeId:"0",talents:{},bonuses:[],map:{zoom:K,initialPosition:{x:0,y:0},position:{x:0,y:0}},build:"",hoveredId:null,searchQuery:"",webpSupported:!1,lang:"ru",graph:null}),actions:{async load(){this.loading=!0,this.webpSupported=fe(),await this.loadSoulTalents(),this.createGraph(),this.loadBuild(),this.loading=!1},async loadSoulTalents(){try{const{width:n,height:e,nodes:t,talents:s,bonuses:o,startFrom:l}=await ye({lang:"ru"});this.width=n*N+64,this.height=e*N+64,this.talents=s,this.nodes=t,this.bonuses=Object.values(o),this.startNodeId=l,this.nodes[l].active=!0,this.map.initialPosition.x=this.nodes[l].x*N,this.map.initialPosition.y=this.nodes[l].y*N}catch{this.error=!0}},async loadBuild(){const n=U.decode(window.location.hash.slice(1));if(n.length===0){this.setClearBuild();return}for(let e=0;e<n.length-1;e+=1)n[e]==="1"&&this.activateNodes([`${e+1}`]);this.setBuild(n)},createGraph(){this.graph=Q(),this.graph.addNode(this.startNodeId)},activateNodes(n,e=!1){n.forEach(t=>{var s;this.nodes[t].active||(this.nodes[t].active=!0,this.updateBuildCell(t,1),(s=this.graph)==null||s.addNode(t),this.nodes[t].connections.forEach(o=>{var l;(l=this.graph)==null||l.addEdge(t,o)}))}),e&&this.checkActiveNodesConnectionWithCenter(),this.updateBuildUrlHash()},deactivateNodes(n){n.forEach(e=>{var t;this.nodes[e].active=!1,this.updateBuildCell(e,0),(t=this.graph)==null||t.removeNode(e)}),this.checkActiveNodesConnectionWithCenter(),this.updateBuildUrlHash()},resetNodes(){this.activeNodesIds.forEach(n=>{var e;n!==this.startNodeId&&(this.nodes[n].active=!1,(e=this.graph)==null||e.removeNode(n))}),this.setClearBuild(),this.updateBuildUrlHash()},checkActiveNodesConnectionWithCenter(){this.activeNodesIds.forEach(n=>{var e;try{(e=this.graph)==null||e.shortestPath(n,"1")}catch{this.nodes[n].active=!1,this.updateBuildCell(n,0)}})},updateBuildCell(n,e){this.build=ge(this.build,parseInt(n,10)-1,e)},setBuild(n){const e=Object.keys(this.nodes).length;if(n.length<e){const t=new Array(e-n.length).fill(0).join("");n=`${n}${t}`,this.build=n}this.build=n,this.updateBuildUrlHash()},setClearBuild(){this.build=[1,...new Array(Object.keys(this.nodes).length-1).fill(0)].join("")},updateBuildUrlHash(){window.history.replaceState(void 0,"",U.encode(this.build))}},getters:{activeNodes(n){return Object.values(n.nodes).filter(({active:e})=>e)},activeNodesIds(){return this.activeNodes.map(({id:n})=>n)}}}),Ce={class:"cell-details"},ke={class:"cell-details__title"},xe={class:"cell-details__description"},$e=["innerHTML"],be=b({__name:"CellDetails",props:{cell:null,talent:null,rank:null,maxRank:null},setup(n){const e=n,t="\u0412\u0430\u0436\u043D\u043E: \u0418\u0433\u0440\u0443\u0448\u043A\u0443 \u043C\u043E\u0436\u043D\u043E \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0442\u043E\u043B\u044C\u043A\u043E \u043E\u0434\u0438\u043D \u0440\u0430\u0437!",{shift:s,alt:o}=G(),l=i(()=>s.value||o.value),a=i(()=>e.rank===0?"1":`${e.rank}`),d=i(()=>e.rank===e.maxRank?"-1":l.value?`${e.maxRank}`:`${e.rank+1}`),r=i(()=>{var _;return(_=e.talent.ranks)==null?void 0:_[a.value]}),m=i(()=>{var _;return(_=e.talent.ranks)==null?void 0:_[d.value]}),y=i(()=>(l.value||!e.cell.active)&&d.value!=="-1"),v=i(()=>{var g;if(e.talent.desc.indexOf(t)!==-1)return`${e.talent.desc.replace(t,"")}<span class="tip-light">${t}</span>`;const _=V.compile(e.talent.desc),B=Object.keys((g=r.value)!=null?g:{}).reduce((x,S)=>{var z,j;const h=(z=r.value)==null?void 0:z[S],C=(j=m.value)==null?void 0:j[S],q=h!==C&&y.value?`${h} => ${C}`:h;return x[S]=`<span class="tip-diff">${q}</span>`,x},{});return _(B)});return(_,u)=>(p(),k("div",Ce,[f("div",ke,T(e.talent.name),1),f("div",xe,[f("p",{innerHTML:c(v)},null,8,$e)])]))}});const we=b({__name:"CellTooltip",props:{container:null,trigger:null,height:null,topSpace:null},setup(n){const e=n,t=E(),s=w(),o=I(e.container),l=I(e.trigger),a=Z(),d=W(),r=i(()=>`scale(${1/s.map.zoom})`),m=i(()=>{const g=u.value?"right":"left",x=v.value?"bottom":"top";return`${g} ${x}`}),y=i(()=>{const g=l.top.value+a.y.value-e.topSpace,x=e.height-g;return{right:d.width.value-l.right.value,bottom:x}}),v=i(()=>y.value.bottom<=o.height.value+32),_=i(()=>!v.value),u=i(()=>y.value.right<=o.width.value+32),B=i(()=>!u.value);return(g,x)=>(p(),k("div",{ref_key:"$el",ref:t,class:H(["cell-tooltip",{"cell-tooltip--top":c(_),"cell-tooltip--left":c(u),"cell-tooltip--bottom":c(v),"cell-tooltip--right":c(B)}]),style:D({transform:c(r),transformOrigin:c(m)})},[J(g.$slots,"default")],6))}});const Se=b({__name:"CellConnectors",props:{cell:null},setup(n){const e=n,t=w(),s=e.cell.x*$.scale+$.x,o=e.cell.y*$.scale+$.y,l=e.cell.connections.map(a=>{const{x:d,y:r}=t.nodes[a],m=d*$.scale+$.x,y=r*$.scale+$.y,v=new ee(m-s,y-o);return{id:a,length:v.length(),angle:v.horizontalAngleDeg()+$.angle}});return(a,d)=>(p(!0),k(P,null,L(c(l),r=>(p(),k("div",{key:r.id,class:H(["cell-connector",{"cell-connector--active":c(t).nodes[r.id].active&&e.cell.active}]),style:D({height:`${r.length}px`,transform:`rotate(${r.angle}deg)`})},null,6))),128))}});function Ne(n,e){const t=w(),s=I(e);let o=null;return te(n,"panzoomchange",l=>{t.map.position.x=l.detail.x,t.map.position.y=l.detail.y}),ne(()=>{if(n.value){const l=s.width.value/2-(t.map.initialPosition.x+F.x),a=s.height.value/2-(t.map.initialPosition.y+F.y);o=oe(n.value,{contain:"outside",startScale:K,minScale:.3,maxScale:1,cursor:!1,startX:l,startY:a}),t.map.position.x=l,t.map.position.y=a,e==null||e.addEventListener("wheel",d=>{d.shiftKey&&o&&(o==null||o.zoomWithWheel(d),t.map.zoom=o.getScale(),t.map.position=o.getPan())})}}),o}function Be(n,e,t){return i(()=>`/soulcalc/data/${e}/icons/${n}.${t?"webp":"png"}`)}function Ee(n,e){const t=i(()=>`${e*N}px`),s=i(()=>`${n*N}px`);return{top:t,left:s}}function Ae(n){const e=w(),t=i(()=>Object.values(e.nodes).filter(o=>o.talentId===n.talentId)),s=i(()=>t.value.filter(o=>e.activeNodesIds.includes(o.id)));return{list:t,active:s}}const Te=["onClick","onContextmenu"],Ie=["src","alt"],He=b({__name:"Cell",props:{container:null,cell:null,talent:null,height:null,topSpace:null,isHoverActivateModeActive:{type:Boolean},isHoverDeactivateModeActive:{type:Boolean}},emits:["cell:activate","cell:deactivate","group:activate","group:deactivate"],setup(n,{emit:e}){const t=n,s=E(),o=E(),l=se(o),a=w(),d=Ee(t.cell.x,t.cell.y),r=Ae(t.cell),m=Be(t.talent.icon,a.lang,a.webpSupported);le(l,h=>{h?(a.hoveredId=t.cell.talentId,t.isHoverActivateModeActive?x():t.isHoverDeactivateModeActive&&S()):a.hoveredId===t.cell.talentId&&(a.hoveredId=null)});const y=i(()=>t.cell.connections.some(h=>a.nodes[h].active||a.nodes[h].id==="1")),v=i(()=>l.value&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),_=i(()=>!1),u=i(()=>a.hoveredId===t.cell.talentId);function B({shiftKey:h,altKey:C}){x(h||C)}function g({shiftKey:h,altKey:C}){S(h||C)}function x(h=!1){y.value&&(h?e("group:activate",r.list.value.map(({id:C})=>C)):e("cell:activate",t.cell.id))}function S(h=!1){t.cell.id!=="1"&&(h?e("group:deactivate",r.active.value.map(({id:C})=>C)):e("cell:deactivate",t.cell.id))}return(h,C)=>(p(),k("div",{ref_key:"$el",ref:s,class:"cell",style:D({top:c(d).top.value,left:c(d).left.value})},[f("div",{ref_key:"contentEl",ref:o,class:H(["cell__content",{"cell__content--start":t.cell.id==="1","cell__content--active":t.cell.active,"cell__content--uncommon":t.cell.quality===4,"cell__content--rare":t.cell.quality===5}]),onClick:M(B,["left","prevent"]),onContextmenu:[M(g,["right","prevent"]),C[0]||(C[0]=M(()=>{},["prevent"]))]},[f("img",{src:c(m),alt:n.talent.name},null,8,Ie),O(` <div class="cell__rank">
        {{ group.active.value.length }}
      </div> `),f("div",{class:H(["cell__frame",{"cell__frame--search":c(_),"cell__frame--group":c(u)}])},null,2)],42,Te),A(Se,{cell:t.cell},null,8,["cell"]),c(v)?(p(),R(we,{key:0,trigger:s.value,height:t.height,"top-space":t.topSpace,container:t.container},{default:ae(()=>[A(be,{cell:t.cell,talent:n.talent,rank:c(r).active.value.length,"max-rank":c(r).list.value.length},null,8,["cell","talent","rank","max-rank"])]),_:1},8,["trigger","height","top-space","container"])):O("v-if",!0)],4))}});const Oe=b({__name:"CalculatorMap",props:{container:null},setup(n){const e=n,t=E(),s=w();Ne(t,e.container);const o=W(),l=I(t),{KeyE:a,KeyQ:d}=G();function r(u){s.activateNodes([u])}function m(u){s.deactivateNodes([u])}function y(u){s.activateNodes(u,!0)}function v(u){s.deactivateNodes(u)}function _(u){a.value&&!s.nodes[u].active?r(u):d.value&&m(u)}return(u,B)=>(p(),k("div",{ref_key:"$el",ref:t,class:"calculator-map",style:D({width:`${c(s).width}px`,height:`${c(s).height}px`})},[(p(!0),k(P,null,L(c(s).nodes,g=>(p(),R(He,{key:g.id,cell:g,talent:c(s).talents[g.talentId],height:c(o).height.value,"top-space":c(l).top.value,"is-hover-activate-mode-active":c(a),"is-hover-deactivate-mode-active":c(d),container:e.container,onHoverToogle:_,"onCell:activate":r,"onCell:deactivate":m,"onGroup:activate":y,"onGroup:deactivate":v},null,8,["cell","talent","height","top-space","is-hover-activate-mode-active","is-hover-deactivate-mode-active","container"]))),128))],4))}});const De={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},Me=f("path",{d:"M0 96c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32 14.3 32 32z"},null,-1);function Le(n,e){return p(),k("svg",De,[O("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),Me])}const Pe={render:Le},Re={class:"calculator-sidebar"},ze={class:"calculator-sidebar__block"},je={class:"calculator-sidebar__block-header"},Ue=f("div",{class:"calculator-sidebar__block-header-text"}," \u042D\u0444\u0444\u0435\u043A\u0442\u044B \u0431\u0438\u043B\u0434\u0430 ",-1),Fe={class:"calculator-sidebar__block-content"},Ge=f("br",null,null,-1),Ve=b({__name:"CalculatorSidebar",setup(n){const e=w(),t=i(()=>ie(e.activeNodes,"talentId")),s=i(()=>e.bonuses.reduce((o,l)=>{const a=l.talents.reduce((d,r)=>{var m,y;if(t.value[r]){const v=t.value[r],u=V.compile(l.desc)((y=(m=e.talents[r].ranks)==null?void 0:m[v])!=null?y:{});d.push({id:`${l.id}.${r}`,talent:e.talents[r],talentRank:v,description:u})}return d},[]);return o.push(...a),o},[]));return(o,l)=>(p(),k("div",Re,[f("div",ze,[f("div",je,[Ue,A(c(Pe),{class:"calculator-sidebar__block-header-icon"})]),f("div",Fe,[(p(!0),k(P,null,L(c(s),a=>(p(),k("p",{key:a.id},[f("b",null,T(a.talent.name)+" (x"+T(a.talentRank)+")",1),Ge,ce(" "+T(a.description),1)]))),128))])])]))}});const We={class:"calculator"},Ke={class:"calculator__sidebar"},Ye=b({__name:"Calculator",setup(n){const e=w();e.load();const t=E(),s=i(()=>!e.loading&&!e.error);return(o,l)=>(p(),k("div",We,[f("div",{ref_key:"container",ref:t,class:"calculator__container"},[c(s)?(p(),R(Oe,{key:0,container:t.value},null,8,["container"])):O("v-if",!0)],512),f("div",Ke,[A(Ve)])]))}});const qe={class:"app"},Xe=b({__name:"App",setup(n){return(e,t)=>(p(),k("div",qe,[A(Ye)]))}});const Y=re(Xe),Qe=ue();Y.use(Qe);Y.mount("#aopro-spark-talents-calc");
