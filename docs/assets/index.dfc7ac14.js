import{s as ee,d as te,g as ne,a as w,u as W,c as u,H as q,o as p,b as m,e as f,t as z,f as se,h as c,i as A,r as T,j as E,k as K,l as oe,n as H,m as P,V as le,p as L,F as O,q as ae,v as ce,P as ie,w as X,x as Y,y as M,z as D,A as I,B as re,C as ue,D as de,E as he,G as pe}from"./vendor.ff954640.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();function _e(n){let t="";for(let s=0;s<n.length;s+=5)t+=parseInt(n.substr(s,5),2).toString(32);return t}function ve(n){let e="";for(let t=0;t<n.length;t+=1){let s=parseInt(n.substr(t,1),32).toString(2);s.length<5&&(s="00000".slice(s.length)+s),e+=s}return e}function fe(n){return`#${_e(n)}`}function ge(n){return ve(n)}const U={encode:fe,decode:ge};function me(){return Math.random().toString(16).slice(2)}function ye(){const n=document.createElement("canvas");if(!n.toDataURL)return!1;n.width=1,n.height=1;try{return n.toDataURL("image/webp").substring(5,15)==="image/webp"}catch{return!1}}function be(n,e,t){return`${n.substring(0,e)}${t}${n.substring(e+1)}`}function ke(n){return Object.keys(n[0]).reduce((e,t)=>{const s=ee(n.map(o=>{var l;return(l=o==null?void 0:o[t])!=null?l:0}));return e[t]=`<span class="tip-summary">${s}</span>`,e},{})}const Ce="/soulcalc/data";async function xe(n){return fetch(`${Ce}/${n.lang}/talents.json?key=${me()}`).then(e=>e.json())}const N=3.5,Q=1,$={scale:N,x:12,y:12,angle:90},F={x:32,y:64},S=te("soulTalents",{state:()=>({loading:!0,error:!1,width:0,height:0,nodes:{},startNodeId:"0",talents:{},bonuses:[],map:{zoom:Q,initialPosition:{x:0,y:0},position:{x:0,y:0}},build:"",highlightIds:[],searchQuery:"",webpSupported:!1,lang:"ru",graph:null}),actions:{async load(){this.loading=!0,this.webpSupported=ye(),await this.loadSoulTalents(),this.createGraph(),this.loadBuild(),this.loading=!1},async loadSoulTalents(){try{const{width:n,height:e,nodes:t,talents:s,bonuses:o,startFrom:l}=await xe({lang:"ru"});this.width=n*N+64,this.height=e*N+64,this.talents=s,this.nodes=t,this.bonuses=Object.values(o),this.startNodeId=l,this.nodes[l].active=!0,this.map.initialPosition.x=this.nodes[l].x*N,this.map.initialPosition.y=this.nodes[l].y*N}catch{this.error=!0}},async loadBuild(){const n=U.decode(window.location.hash.slice(1));if(n.length===0){this.setClearBuild();return}for(let e=0;e<n.length-1;e+=1)n[e]==="1"&&this.activateNodes([`${e+1}`]);this.setBuild(n)},createGraph(){this.graph=ne(),this.graph.addNode(this.startNodeId)},activateNodes(n,e=!1){n.forEach(t=>{var s;this.nodes[t].active||(this.nodes[t].active=!0,this.updateBuildCell(t,1),(s=this.graph)==null||s.addNode(t),this.nodes[t].connections.forEach(o=>{var l;(l=this.graph)==null||l.addEdge(t,o)}))}),e&&this.checkActiveNodesConnectionWithCenter(),this.updateBuildUrlHash()},deactivateNodes(n,e=!0,t=!0){n.forEach(s=>{var o;s!==this.startNodeId&&(this.nodes[s].active=!1,this.updateBuildCell(s,0),(o=this.graph)==null||o.removeNode(s))}),e&&this.checkActiveNodesConnectionWithCenter(),t&&this.updateBuildUrlHash()},deactivateTalents(n){n.forEach(e=>{const t=this.activeNodes.filter(s=>s.talentId===e).map(({id:s})=>s);this.deactivateNodes(t,!1,!1)}),this.checkActiveNodesConnectionWithCenter(),this.updateBuildUrlHash()},resetNodes(){this.activeNodesIds.forEach(n=>{var e;n!==this.startNodeId&&(this.nodes[n].active=!1,(e=this.graph)==null||e.removeNode(n))}),this.setClearBuild(),this.updateBuildUrlHash()},checkActiveNodesConnectionWithCenter(){this.activeNodesIds.forEach(n=>{var e;try{(e=this.graph)==null||e.shortestPath(n,"1")}catch{this.nodes[n].active=!1,this.updateBuildCell(n,0)}})},updateBuildCell(n,e){this.build=be(this.build,parseInt(n,10)-1,e)},setBuild(n){const e=Object.keys(this.nodes).length;if(n.length<e){const t=new Array(e-n.length).fill(0).join("");n=`${n}${t}`,this.build=n}this.build=n,this.updateBuildUrlHash()},setClearBuild(){this.build=[1,...new Array(Object.keys(this.nodes).length-1).fill(0)].join("")},updateBuildUrlHash(){window.history.replaceState(void 0,"",U.encode(this.build))}},getters:{activeNodes(n){return Object.values(n.nodes).filter(({active:e})=>e)},activeNodesIds(){return this.activeNodes.map(({id:n})=>n)}}}),$e={class:"cell-details"},we={class:"cell-details__title"},Se={class:"cell-details__rank"},Be={key:0,class:"tip-green"},Ne={class:"cell-details__description"},Te=["innerHTML"],Ae=w({__name:"CellDetails",props:{cell:null,talent:null,rank:null,maxRank:null},setup(n){const e=n,{shift:t,alt:s}=W(),o=u(()=>t.value||s.value),l=u(()=>e.rank===0?"1":`${e.rank}`),a=u(()=>e.rank===e.maxRank?"-1":o.value?`${e.maxRank}`:`${e.rank+1}`),r=u(()=>{var h;return(h=e.talent.ranks)==null?void 0:h[l.value]}),i=u(()=>{var h;return(h=e.talent.ranks)==null?void 0:h[a.value]}),d=u(()=>(o.value||!e.cell.active)&&a.value!=="-1"),v=u(()=>{var x;const h=q.compile(e.talent.desc),_=Object.keys((x=r.value)!=null?x:{}).reduce((g,k)=>{var R,j;const B=(R=r.value)==null?void 0:R[k],y=(j=i.value)==null?void 0:j[k],J=B!==y&&d.value?`${B} => ${y}`:B;return g[k]=`<span class="tip-diff">${J}</span>`,g},{});return h(_)});return(h,b)=>(p(),m("div",$e,[f("div",we,z(e.talent.name),1),f("div",Se,[se(" \u0420\u0430\u043D\u0433: "+z(c(l))+" ",1),c(d)&&c(a)!=="1"?(p(),m("span",Be," => "+z(c(a)),1)):A("v-if",!0)]),f("div",Ne,[f("p",{innerHTML:c(v)},null,8,Te)])]))}});const Ie=w({__name:"CellTooltip",props:{container:null,trigger:null,height:null,topSpace:null},setup(n){const e=n,t=T(),s=S(),o=E(t),l=E(e.trigger),a=E(e.container),r=K(),i=u(()=>`scale(${1/s.map.zoom})`),d=u(()=>{const g=_.value?"right":"left",k=h.value?"bottom":"top";return`${g} ${k}`}),v=u(()=>{const g=o.top.value-a.top.value,k=e.height-g,B=r.width.value-l.right.value;return{top:g,right:B,bottom:k}}),h=u(()=>v.value.bottom<=a.height.value+32),b=u(()=>!h.value),_=u(()=>v.value.right<=a.width.value+32),x=u(()=>!_.value);return(g,k)=>(p(),m("div",{ref_key:"$el",ref:t,class:H(["cell-tooltip",{"cell-tooltip--top":c(b),"cell-tooltip--left":c(_),"cell-tooltip--bottom":c(h),"cell-tooltip--right":c(x)}]),style:P({transform:c(i),transformOrigin:c(d)})},[oe(g.$slots,"default")],6))}});const Ee=w({__name:"CellConnectors",props:{cell:null},setup(n){const e=n,t=S(),s=e.cell.x*$.scale+$.x,o=e.cell.y*$.scale+$.y,l=e.cell.connections.map(a=>{const{x:r,y:i}=t.nodes[a],d=r*$.scale+$.x,v=i*$.scale+$.y,h=new le(d-s,v-o);return{id:a,length:h.length(),angle:h.horizontalAngleDeg()+$.angle}});return(a,r)=>(p(!0),m(O,null,L(c(l),i=>(p(),m("div",{key:i.id,class:H(["cell-connector",{"cell-connector--active":c(t).nodes[i.id].active&&e.cell.active}]),style:P({height:`${i.length}px`,transform:`rotate(${i.angle}deg)`})},null,6))),128))}});function He(n,e){const t=S(),s=E(e);let o=null;return ae(n,"panzoomchange",l=>{t.map.position.x=l.detail.x,t.map.position.y=l.detail.y}),ce(()=>{if(n.value){const l=s.width.value/2-(t.map.initialPosition.x+F.x),a=s.height.value/2-(t.map.initialPosition.y+F.y);o=ie(n.value,{contain:"outside",startScale:Q,minScale:.3,maxScale:1,cursor:!1,startX:l,startY:a,step:.1}),t.map.position.x=l,t.map.position.y=a,e==null||e.addEventListener("wheel",r=>{if(o){const{x:i,y:d,scale:v}=o.zoomWithWheel(r);t.map.zoom=v,t.map.position.x=i,t.map.position.y=d}})}}),o}function De(n,e,t){return u(()=>`/soulcalc/data/${e}/icons/${n}.${t?"webp":"png"}`)}function Me(n,e){const t=u(()=>`${e*N}px`),s=u(()=>`${n*N}px`);return{top:t,left:s}}function Le(n){const e=S(),t=u(()=>Object.values(e.nodes).filter(o=>o.talentId===n.talentId)),s=u(()=>t.value.filter(o=>e.activeNodesIds.includes(o.id)));return{list:t,active:s}}const Oe=["onClick","onContextmenu"],Pe=["src","alt"],ze=w({__name:"Cell",props:{container:null,cell:null,talent:null,height:null,topSpace:null,isHoverActivateModeActive:{type:Boolean},isHoverDeactivateModeActive:{type:Boolean}},emits:["cell:activate","cell:deactivate","group:activate","group:deactivate"],setup(n,{emit:e}){const t=n,s=T(),o=T(),l=X(o),a=S(),r=Me(t.cell.x,t.cell.y),i=Le(t.cell),d=De(t.talent.icon,a.lang,a.webpSupported);Y(l,y=>{y?(a.highlightIds=[t.cell.talentId],t.isHoverActivateModeActive?k():t.isHoverDeactivateModeActive&&B()):a.highlightIds.includes(t.cell.talentId)&&(a.highlightIds=[])});const v=u(()=>t.cell.connections.some(y=>a.nodes[y].active||a.nodes[y].id==="1")),h=u(()=>l.value&&!(t.isHoverActivateModeActive||t.isHoverDeactivateModeActive)),b=u(()=>!1),_=u(()=>a.highlightIds.includes(t.cell.talentId));function x({shiftKey:y,altKey:C}){k(y||C)}function g({shiftKey:y,altKey:C}){B(y||C)}function k(y=!1){v.value&&(y?e("group:activate",i.list.value.map(({id:C})=>C)):e("cell:activate",t.cell.id))}function B(y=!1){t.cell.id!=="1"&&(y?e("group:deactivate",i.active.value.map(({id:C})=>C)):e("cell:deactivate",t.cell.id))}return(y,C)=>(p(),m("div",{ref_key:"$el",ref:s,class:"cell",style:P({top:c(r).top.value,left:c(r).left.value})},[f("div",{ref_key:"contentEl",ref:o,class:H(["cell__content",{"cell__content--start":t.cell.id==="1","cell__content--active":t.cell.active,"cell__content--uncommon":t.cell.quality===4,"cell__content--rare":t.cell.quality===5}]),onClick:M(x,["left","prevent"]),onContextmenu:[M(g,["right","prevent"]),C[0]||(C[0]=M(()=>{},["prevent"]))]},[f("img",{src:c(d),alt:n.talent.name},null,8,Pe),f("div",{class:H(["cell__frame",{"cell__frame--search":c(b),"cell__frame--group":c(_)}])},null,2)],42,Oe),D(Ee,{cell:t.cell},null,8,["cell"]),c(h)?(p(),I(Ie,{key:0,trigger:s.value,height:t.height,"top-space":t.topSpace,container:t.container},{default:re(()=>[D(Ae,{cell:t.cell,talent:n.talent,rank:c(i).active.value.length,"max-rank":c(i).list.value.length},null,8,["cell","talent","rank","max-rank"])]),_:1},8,["trigger","height","top-space","container"])):A("v-if",!0)],4))}});const Re=w({__name:"CalculatorMap",props:{container:null},setup(n){const e=n,t=T(),s=S();He(t,e.container);const o=K(),l=E(t),{KeyE:a,KeyQ:r}=W();function i(_){s.activateNodes([_])}function d(_){s.deactivateNodes([_])}function v(_){s.activateNodes(_,!0)}function h(_){s.deactivateNodes(_)}function b(_){a.value&&!s.nodes[_].active?i(_):r.value&&d(_)}return(_,x)=>(p(),m("div",{ref_key:"$el",ref:t,class:"calculator-map",style:P({width:`${c(s).width}px`,height:`${c(s).height}px`})},[(p(!0),m(O,null,L(c(s).nodes,g=>(p(),I(ze,{key:g.id,cell:g,talent:c(s).talents[g.talentId],height:c(o).height.value,"top-space":c(l).top.value,"is-hover-activate-mode-active":c(a),"is-hover-deactivate-mode-active":c(r),container:e.container,onHoverToogle:b,"onCell:activate":i,"onCell:deactivate":d,"onGroup:activate":v,"onGroup:deactivate":h},null,8,["cell","talent","height","top-space","is-hover-activate-mode-active","is-hover-deactivate-mode-active","container"]))),128))],4))}});const je=["onClick"],Ue=["innerHTML"],G=w({__name:"CalculatorBonuse",props:{bonuse:null},setup(n){const e=n,t=T(),s=T(!1),o=X(t),l=S();Y(o,d=>{d?l.highlightIds=e.bonuse.talents:(s.value=!1,l.highlightIds=[])}),ue(t,i,{delay:1500});function a(){s.value=!0}function r(){}function i(){l.highlightIds=[],s.value=!1,l.deactivateTalents(e.bonuse.talents)}return(d,v)=>(p(),m("div",{ref_key:"$el",ref:t,class:H(["calculator-bonuse",{"calculator-bonuse--mousedown":s.value}]),onClick:M(r,["left"]),onMousedown:a},[f("p",{innerHTML:e.bonuse.text},null,8,Ue)],42,je))}});const Fe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},Ge=f("path",{d:"M0 96c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32 14.3 32 32z"},null,-1);function Ve(n,e){return p(),m("svg",Fe,[A("! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc."),Ge])}const V={render:Ve},We={class:"calculator-sidebar"},qe={class:"calculator-sidebar__block"},Ke={class:"calculator-sidebar__block-header"},Xe=f("div",{class:"calculator-sidebar__block-header-text"}," \u042D\u0444\u0444\u0435\u043A\u0442\u044B ",-1),Ye={class:"calculator-sidebar__block-content"},Qe={key:1,class:"calculator-sidebar__block-content-placeholder"},Ze={key:0,class:"calculator-sidebar__block"},Je={class:"calculator-sidebar__block-header"},et=f("div",{class:"calculator-sidebar__block-header-text"}," \u0421\u043F\u0443\u0442\u043D\u0438\u043A\u0438 ",-1),tt={class:"calculator-sidebar__block-content"},nt=w({__name:"CalculatorSidebar",setup(n){const e=S(),t=u(()=>de(e.activeNodes,"talentId")),s=e.bonuses.findIndex(({isToy:a})=>a),o=u(()=>{var r,i;return((i=(r=e.bonuses[s])==null?void 0:r.talents)!=null?i:[]).reduce((d,v)=>{var h;if(t.value[v]){const b=(h=e.talents[v])==null?void 0:h.name;b&&d.push({text:b,talents:[v]})}return d},[])}),l=u(()=>e.bonuses.reduce((a,r)=>{if(r.talents.every(b=>t.value[b]===void 0)||r.isToy)return a;const d=r.talents.map(b=>{var x,g;const _=t.value[b];return(g=(x=e.talents[b].ranks)==null?void 0:x[_])!=null?g:{}}),v=q.compile(r.desc),h=ke(d);return a.push({text:v(h),talents:r.talents}),a},[]));return(a,r)=>(p(),m("div",We,[f("div",qe,[f("div",Ke,[Xe,D(c(V),{class:"calculator-sidebar__block-header-icon"})]),f("div",Ye,[c(l).length?(p(!0),m(O,{key:0},L(c(l),(i,d)=>(p(),I(G,{key:d,bonuse:i},null,8,["bonuse"]))),128)):(p(),m("div",Qe," \u041D\u0435\u0442 \u044D\u0444\u0444\u0435\u043A\u0442\u043E\u0432 \u043E\u0442 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0432\u0435\u0445 "))])]),c(o).length?(p(),m("div",Ze,[f("div",Je,[et,D(c(V),{class:"calculator-sidebar__block-header-icon"})]),f("div",tt,[(p(!0),m(O,null,L(c(o),(i,d)=>(p(),I(G,{key:d,bonuse:i},null,8,["bonuse"]))),128))])])):A("v-if",!0)]))}});const st={class:"calculator"},ot={class:"calculator__sidebar"},lt=f("div",{id:"tooltip-area",class:"calculator__tooltips"},null,-1),at=w({__name:"Calculator",setup(n){const e=S();e.load();const t=T(),s=u(()=>!e.loading&&!e.error);return(o,l)=>(p(),m("div",st,[f("div",{ref_key:"container",ref:t,class:"calculator__container"},[c(s)?(p(),I(Re,{key:0,container:t.value},null,8,["container"])):A("v-if",!0)],512),f("div",ot,[c(s)?(p(),I(nt,{key:0})):A("v-if",!0)]),lt]))}});const ct={class:"app"},it=w({__name:"App",setup(n){return(e,t)=>(p(),m("div",ct,[D(at)]))}});const Z=he(it),rt=pe();Z.use(rt);Z.mount("#aopro-spark-talents-calc");
